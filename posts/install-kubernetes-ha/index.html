<!DOCTYPE html>
<html 
      
      
      
      data-bs-theme="light" itemscope="" itemtype="http://schema.org/WebPage" lang="en">
  <head><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />







      
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?display=swap&amp;family=&#43;JetBrains&#43;Mono&amp;family=JetBrains&#43;Mono%3Aital%2Cwght%400%2C600%3B1%2C600..900" rel="stylesheet">

    <link rel="manifest" href="https://blog.mletter.cn/manifest.webmanifest" />

<meta name="description" content="如何使用kubeadm方案来安装高可用的kubernetes集群" />






<meta property="og:title" content="利用Kubeadm进行多Master高可用部署" />
<meta property="og:description" content="如何使用kubeadm方案来安装高可用的kubernetes集群" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.mletter.cn/posts/install-kubernetes-ha/" /><meta property="og:image" content="https://fc.sinaimg.cn/large/005Czbxjgy1hlm862knaqj30sg0e875n.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-12-29T00:00:00+00:00" />
<meta itemprop="name" content="利用Kubeadm进行多Master高可用部署">
<meta itemprop="description" content="如何使用kubeadm方案来安装高可用的kubernetes集群"><meta itemprop="datePublished" content="2022-12-29T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-12-29T00:00:00+00:00" />
<meta itemprop="wordCount" content="940"><meta itemprop="image" content="https://fc.sinaimg.cn/large/005Czbxjgy1hlm862knaqj30sg0e875n.jpg">
<meta itemprop="keywords" content="kubernetes," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://fc.sinaimg.cn/large/005Czbxjgy1hlm862knaqj30sg0e875n.jpg"/>

<meta name="twitter:title" content="利用Kubeadm进行多Master高可用部署"/>
<meta name="twitter:description" content="如何使用kubeadm方案来安装高可用的kubernetes集群"/>



    <title>


利用Kubeadm进行多Master高可用部署 - Posts - </title>

  
  
  


    <link href="/css/hb.css" rel="stylesheet" />






<script
  src="/js/init.js"
  ></script>






  </head>
  <body 
><noscript>
  <div class="alert alert-danger text-center rounded-0" role="alert"><svg aria-hidden="true" class="bi bi-exclamation-square-fillbi bi-exclamation-square-fill hi-svg-inline me-2" fill="currentColor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg">
  <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm6 4c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995A.905.905 0 0 1 8 4m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
</svg>Your browser does not support JavaScript.</div>
</noscript>



    
<header class="hb-header"
  >
  

  <nav class="hb-header-nav navbar navbar-expand-lg">
    
  <div class="hb-announcement-bar text-center px-1 py-2 w-100 overflow-hidden border-bottom border-secondary">
          <a
            class="hb-announcement text-decoration-none text-truncate active"
            href="/bulletin/2024/0108/">2024年本站大更新啦,查看更新内容轻点我哦<svg aria-hidden="true" class="bi bi-arrow-rightbi bi-arrow-right hi-svg-inline ms-1" fill="currentColor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
</svg></a>
  </div>



    <div
      class="container-fluid">
      


  <a
    class="navbar-brand d-flex align-items-center"
    href="/">人间只是春</a>

      <div class="d-flex order-5">
        
<div class="search-modal-toggle hb-header-search-form position-relative d-flex ms-lg-1">
  <button
    type="button"
    class="hb-header-search-icon border-0 bg-transparent px-2"
    aria-label="Toggle search">
    <svg aria-hidden="true" class="bi bi-searchbi bi-search hi-svg-inline" fill="currentColor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg">
  <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
</svg>
  </button>
  <input
    class="form-control rounded-5 d-none d-lg-block ms-lg-1"
    placeholder="Search" />
    <span class="hb-header-search-keys position-absolute d-none d-lg-block">
        <kbd>CTRL</kbd>
        <kbd>K</kbd>
    </span>
</div>



        <button
          class="navbar-toggler border-0 shadow-none"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#hb-header-content"
          aria-controls="hb-header-content"
          aria-label="Toggle navigation"><svg aria-hidden="true" class="bi bi-three-dotsbi bi-three-dots hi-svg-inline" fill="currentColor" height="1.25em" viewBox="0 0 16 16" width="1.25em" xmlns="http://www.w3.org/2000/svg">
  <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"/>
</svg>
        </button>
        

      </div>
      <div
        class="offcanvas offcanvas-lg offcanvas-end"
        tabindex="-1"
        id="hb-header-content"
        aria-labelledby="hb-header-content-label">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="hb-header-content-label">人间只是春</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="offcanvas"
            aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          
          <ul class="hb-header-menus navbar-nav flex-row flex-wrap"><li
    class="hb-header-menu nav-item col-6 col-lg-auto">
    <a
      class="nav-link"
      
      href="https://blog.mletter.cn/"
      
      ><svg aria-hidden="true" class="hi-svg-inline hb-header-menu-icon me-1" fill="currentColor" height="1em" id="mdi-home-edit-outline" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M 21.0413,11.14C 21.1827,11.14 21.3173,11.1973 21.4213,11.3027L 22.6973,12.5787C 22.912,12.792 22.912,13.14 22.6973,13.3493L 21.6973,14.3493L 19.6507,12.3027L 20.6507,11.3027C 20.76,11.1973 20.9013,11.14 21.0413,11.14 Z M 19.0627,12.88L 21.1093,14.932L 15.0627,21L 13,21L 13,18.9373L 19.0627,12.88 Z M 12,5.688L 7,10.188L 7,18L 11,18L 11,20L 5,20L 5,12L 2,12L 12,3L 19.4587,9.71285L 17,12.1716L 17,10.188L 12,5.688 Z" /></svg>首页</a>
  </li><li
    class="hb-header-menu nav-item col-6 col-lg-auto active">
    <a
      class="nav-link active"
      aria-current="page"
      href="https://blog.mletter.cn/posts"
      
      ><svg aria-hidden="true" class="hi-svg-inline hb-header-menu-icon me-1" fill="currentColor" height="1em" id="mdi-post" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3 3V21H21V3H3M18 18H6V17H18V18M18 16H6V15H18V16M18 12H6V6H18V12Z" /></svg>文章</a>
  </li><li
    class="hb-header-menu nav-item col-6 col-lg-auto">
    <a
      class="nav-link"
      
      href="https://blog.mletter.cn/categories"
      
      ><svg aria-hidden="true" class="hi-svg-inline hb-header-menu-icon me-1" fill="currentColor" height="1em" id="mdi-archive" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3,3H21V7H3V3M4,8H20V21H4V8M9.5,11A0.5,0.5 0 0,0 9,11.5V13H15V11.5A0.5,0.5 0 0,0 14.5,11H9.5Z" /></svg>分类</a>
  </li><li
    class="hb-header-menu nav-item col-6 col-lg-auto">
    <a
      class="nav-link"
      
      href="https://blog.mletter.cn/tags"
      
      ><svg aria-hidden="true" class="hi-svg-inline hb-header-menu-icon me-1" fill="currentColor" height="1em" id="mdi-tag-multiple" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M5.5,9A1.5,1.5 0 0,0 7,7.5A1.5,1.5 0 0,0 5.5,6A1.5,1.5 0 0,0 4,7.5A1.5,1.5 0 0,0 5.5,9M17.41,11.58C17.77,11.94 18,12.44 18,13C18,13.55 17.78,14.05 17.41,14.41L12.41,19.41C12.05,19.77 11.55,20 11,20C10.45,20 9.95,19.78 9.58,19.41L2.59,12.42C2.22,12.05 2,11.55 2,11V6C2,4.89 2.89,4 4,4H9C9.55,4 10.05,4.22 10.41,4.58L17.41,11.58M13.54,5.71L14.54,4.71L21.41,11.58C21.78,11.94 22,12.45 22,13C22,13.55 21.78,14.05 21.42,14.41L16.04,19.79L15.04,18.79L20.75,13L13.54,5.71Z" /></svg>标签</a>
  </li><li
    class="hb-header-menu nav-item col-6 col-lg-auto">
    <a
      class="nav-link"
      
      href="https://blog.mletter.cn/about"
      
      ><svg aria-hidden="true" class="hi-svg-inline hb-header-menu-icon me-1" fill="currentColor" height="1em" id="mdi-near-me" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21,3L3,10.53V11.5L9.84,14.16L12.5,21H13.46L21,3Z" /></svg>关于</a>
  </li><li
    class="hb-header-menu nav-item col-6 col-lg-auto">
    <a
      class="nav-link"
      
      href="https://blog.mletter.cn/friends"
      
      ><svg aria-hidden="true" class="hi-svg-inline hb-header-menu-icon me-1" fill="currentColor" height="1em" id="mdi-link-edit" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M13 22V19.96L19.13 13.83L21.17 15.88L15.04 22H13M21.53 12.15L22.85 13.47C23.05 13.67 23.05 14 22.85 14.19L21.87 15.17L19.83 13.13L20.81 12.15C21 11.95 21.33 11.95 21.53 12.15M20.54 8.46C20.73 8.65 20.9 8.86 21.06 9.08L19.68 10.45C19.15 9.5 18.15 8.9 17 8.9H13V7H17C18.33 7 19.6 7.53 20.54 8.46M3.9 12C3.9 10.29 5.29 8.9 7 8.9H11V7H7C5.67 7 4.4 7.53 3.46 8.46C2.53 9.4 2 10.67 2 12C2 13.33 2.53 14.6 3.46 15.54C4.4 16.47 5.67 17 7 17H11V15.1H7C5.29 15.1 3.9 13.71 3.9 12M8 13H16V11H8V13Z" /></svg>友情链接</a>
  </li></ul>
          
          
          <ul class="hb-header-panel navbar-nav flex-row flex-wrap">
              <li class="nav-item py-2 py-lg-1 col-12 col-lg-auto">
                <hr class="d-lg-none my-2 text-body-50" />
              </li>
            
  <li class="nav-item col-6 col-lg-auto d-flex align-items-center">
<a
  class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center"
  href="beilanzhisen@163.com"
  target="_blank"
  rel="nofollow me"
  title="Gmail"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentColor" height="1em" role="img" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Gmail</title><path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"/></svg>
    <span class="hb-social-text d-lg-none ms-1">Gmail</span>
</a>

  </li>

  <li class="nav-item py-2 py-lg-1 col-12 col-lg-auto">
    <div class="vr d-none d-lg-flex h-100 mx-lg-2 text-body"></div>
    <hr class="d-lg-none my-2 text-body-50" />
  </li>


<li class="theme-toggle nav-item dropdown col-6 col-lg-auto d-flex flex-column justify-content-center">
  <a
    class="btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-start justify-content-lg-center align-items-center"
    href="#"
    role="button"
    data-bs-toggle="dropdown"
    aria-expanded="false"
  >
    <svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1 theme-toggle-icon" fill="currentColor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg">
  <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16"/>
</svg>
    <span class="d-lg-none ms-1">Theme</span>
  </a>

  <ul class="theme-toggle-menu dropdown-menu dropdown-menu-end">
      <li>
        <button
          class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center"
          data-bs-theme-value="auto"
        >
          <span class="theme-toggle-item-icon me-1 d-flex align-items-center">
            <svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1" fill="currentColor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg">
  <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16"/>
</svg>
          </span>
          Auto
        </button>
      </li>
      <li>
        <button
          class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center"
          data-bs-theme-value="dark"
        >
          <span class="theme-toggle-item-icon me-1 d-flex align-items-center">
            <svg aria-hidden="true" class="bi bi-moon-starsbi bi-moon-stars hi-svg-inline my-1" fill="currentColor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg">
  <path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278M4.858 1.311A7.27 7.27 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.32 7.32 0 0 0 5.205-2.162q-.506.063-1.029.063c-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286"/>
  <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.73 1.73 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.73 1.73 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.73 1.73 0 0 0 1.097-1.097zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.16 1.16 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.16 1.16 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732z"/>
</svg>
          </span>
          Dark
        </button>
      </li>
      <li>
        <button
          class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center"
          data-bs-theme-value="light"
        >
          <span class="theme-toggle-item-icon me-1 d-flex align-items-center">
            <svg aria-hidden="true" class="bi bi-brightness-highbi bi-brightness-high hi-svg-inline my-1" fill="currentColor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg">
  <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708"/>
</svg>
          </span>
          Light
        </button>
      </li>
  </ul>
</li>



          </ul>
          
        </div>
      </div>
    </div>
    

  </nav>
  

</header>



    

    <div 
      
      class="hb-main container hb-main container">
  <div class="hb-blog-main-container">
  <div class="hb-blog-main">
    <div class="container-fluid px-0 mb-4">
    <nav aria-label="breadcrumb">
      <ol class="hb-breadcrumb breadcrumb">
          <li class="breadcrumb-item">
            <a href="/" title="">Home</a>
          </li>
          <li class="breadcrumb-item">
            <a href="/posts/" title="Posts">Posts</a>
          </li><li class="breadcrumb-item active" aria-current="page">
          <a href="/posts/install-kubernetes-ha/" title="利用Kubeadm进行多Master高可用部署">利用Kubeadm进行多Master高可用部署</a>
        </li>
      </ol>
    </nav>
  </div>


    <div class="hb-blog-post position-relative">
      <div class="hb-blog-post-intro hb-module mb-2">
        <h1 class="hb-blog-post-title">利用Kubeadm进行多Master高可用部署</h1>
        <div class="hb-blog-post-meta">
          

          <span class="hb-blog-post-date">December 29, 2022</span>

          <span class="hb-blog-post-reading-time">5 min read</span>

          
    
      <span class="hb-blog-post-taxonomy-meta">
        <a
          class="hb-blog-post-taxonomy hb-blog-post-taxonomy-category badge bg-secondary text-decoration-none fw-normal me-1"
          href="/categories/kubernetes/">kubernetes</a>
      </span>
      <span class="hb-blog-post-taxonomy-meta">
        <a
          class="hb-blog-post-taxonomy hb-blog-post-taxonomy-tag badge bg-secondary text-decoration-none fw-normal me-1"
          href="/tags/kubernetes/">kubernetes</a>
      </span>
        </div>
          <div class="hb-blog-post-desc lead mt-1">如何使用kubeadm方案来安装高可用的kubernetes集群</div>
      </div>
        <div class="hb-blog-post-toc text-body-secondary position-sticky overflow-y-auto">

<div class="hb-module pb-1">
  <div class="h6 d-none d-md-block">On this page</div>
  <hr class="d-none d-md-block" />
  <div class="d-grid d-block d-md-none mb-2">
    <button
      class="btn btn-light d-flex align-items-center justify-content-between collapsed"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target=".hb-blog-post-toc-collapse"
      aria-expanded="false"
      aria-controls="collapse-toc">
      <span>On this page</span>
      <svg aria-hidden="true" class="bi bi-chevron-expandbi bi-chevron-expand hi-svg-inline ms-2" fill="currentColor" height="1.25rem" viewBox="0 0 16 16" width="1.25rem" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M3.646 9.146a.5.5 0 0 1 .708 0L8 12.793l3.646-3.647a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 0-.708m0-2.292a.5.5 0 0 0 .708 0L8 3.207l3.646 3.647a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 0 0 0 .708"/>
</svg>
    </button>
  </div>
  <div class="px-2 px-md-0">
    <div id="collapse-toc" class="collapse hb-blog-post-toc-collapse"><nav id="TableOfContents">
  <ul>
    <li><a href="#参与主机列表">参与主机列表</a></li>
    <li><a href="#为kube-apiserver创建负载均衡器">为Kube-apiserver创建负载均衡器</a></li>
    <li><a href="#配置master主机节点的hosts文件">配置Master主机节点的Hosts文件</a>
      <ul>
        <li><a href="#设置etcd集群证书">设置Etcd集群证书</a></li>
      </ul>
    </li>
    <li><a href="#设置第一个控制平面节点">设置第一个控制平面节点</a></li>
    <li><a href="#运行网络cni插件calico">运行网络CNI插件(Calico)</a>
      <ul>
        <li><a href="#修改calicoyaml配置">修改Calico.yaml配置</a></li>
      </ul>
    </li>
    <li><a href="#将其他控制平面节点加入集群">将其他控制平面节点加入集群</a></li>
    <li><a href="#将工作节点加入集群">将工作节点加入集群</a></li>
    <li><a href="#可选项修改kubelet的数据存储目录">(可选项)修改Kubelet的数据存储目录</a></li>
    <li><a href="#如何剔除一个master">如何剔除一个Master</a></li>
  </ul>
</nav></div>
  </div>
</div>


        </div>
      <div class="hb-blog-post-main">

  <div class="hb-module p-0 text-center">
    












  
  
    <picture>
  <img
    class="hb-featured-img img-fluid p-1 bg-body-secondary border w-100"
    src="https://fc.sinaimg.cn/large/005Czbxjgy1hlm862knaqj30sg0e875n.jpg"
    alt="利用Kubeadm进行多Master高可用部署"
    
    
    
    
    
    
     />
</picture>

  </div>

        <div
          class="hb-blog-post-content hb-module"
          >

          <h1 id="利用kubeadm创建高可用集群">利用Kubeadm创建高可用集群</h1>
<ul>
<li>使用具有堆叠的控制平面节点。这种方法所需基础设施较少。etcd 成员和控制平面节点位于同一位置。</li>
<li>使用外部 etcd 集群。这种方法所需基础设施较多。控制平面的节点和 etcd 成员是分开的。
在下一步之前，你应该仔细考虑哪种方法更好地满足你的应用程序和环境的需求。 高可用拓扑选项 讲述了每种方法的优缺点。</li>
<li><a
  href="https://i.mletter.cn/2022/09/22/Kubernetes-1.22.10%E9%83%A8%E7%BD%B2/#kubernetes%E5%AE%89%E8%A3%85"
  
  target="_blank" rel="noopener noreferrer">如何安装Kubectl和Kubeadm</a></li>
<li><a
  href="https://i.mletter.cn/2022/12/26/Kubeadm%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84Etcd%E9%9B%86%E7%BE%A4/"
  
  target="_blank" rel="noopener noreferrer">如何安装外部的Etcd集群</a></li>
</ul>
<h2 id="参与主机列表">参与主机列表</h2>
<table>
<thead>
<tr>
<th>IP</th>
<th>CPU</th>
<th>内存</th>
<th style="text-align:left">硬盘</th>
<th style="text-align:left">角色</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.1.6.48</td>
<td>8</td>
<td>16</td>
<td style="text-align:left">100</td>
<td style="text-align:left">control-plane1</td>
</tr>
<tr>
<td>10.1.6.24</td>
<td>8</td>
<td>16</td>
<td style="text-align:left">100</td>
<td style="text-align:left">control-plane2</td>
</tr>
<tr>
<td>10.1.6.45</td>
<td>8</td>
<td>16</td>
<td style="text-align:left">100</td>
<td style="text-align:left">control-plane3</td>
</tr>
<tr>
<td>10.1.6.46</td>
<td>8</td>
<td>16</td>
<td style="text-align:left">100</td>
<td style="text-align:left">work1</td>
</tr>
<tr>
<td>10.1.6.43</td>
<td>8</td>
<td>16</td>
<td style="text-align:left">100</td>
<td style="text-align:left">work2</td>
</tr>
<tr>
<td>10.1.6.47</td>
<td>8</td>
<td>16</td>
<td style="text-align:left">100</td>
<td style="text-align:left">work3</td>
</tr>
<tr>
<td>10.1.6.213</td>
<td>4</td>
<td>4</td>
<td style="text-align:left">20</td>
<td style="text-align:left">HA+KP1</td>
</tr>
<tr>
<td>10.1.6.214</td>
<td>4</td>
<td>4</td>
<td style="text-align:left">20</td>
<td style="text-align:left">HA+KP2</td>
</tr>
<tr>
<td>10.1.6.215</td>
<td></td>
<td></td>
<td style="text-align:left"></td>
<td style="text-align:left">Load_Balancer_IP</td>
</tr>
<tr>
<td>10.1.6.51</td>
<td>8</td>
<td>16</td>
<td style="text-align:left">100</td>
<td style="text-align:left">Etcd1</td>
</tr>
<tr>
<td>10.1.6.52</td>
<td>8</td>
<td>16</td>
<td style="text-align:left">100</td>
<td style="text-align:left">Etcd2</td>
</tr>
<tr>
<td>10.1.6.53</td>
<td>8</td>
<td>16</td>
<td style="text-align:left">100</td>
<td style="text-align:left">Etcd3</td>
</tr>
</tbody>
</table>
<h2 id="为kube-apiserver创建负载均衡器">为Kube-apiserver创建负载均衡器</h2>
<p>Keepalived 提供 VRRP 实现，并允许您配置 Linux 机器使负载均衡，预防单点故障。HAProxy 提供可靠、高性能的负载均衡，能与 Keepalived 完美配合。</p>
<p>由于 lb1 和 lb2 上安装了 Keepalived 和 HAproxy，如果其中一个节点故障，虚拟 IP 地址（即浮动 IP 地址）将自动与另一个节点关联，使集群仍然可以正常运行，从而实现高可用。若有需要，也可以此为目的，添加更多安装 Keepalived 和 HAproxy 的节点。</p>
<p>先运行以下命令安装 <code>Keepalived</code> 和 <code>HAproxy</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">yum install keepalived haproxy psmisc -y
</span></span><span class="line"><span class="ln">2</span><span class="cl">dnf install keepalived haproxy psmisc -y
</span></span></code></pre></div><p>在两台用于负载均衡的机器上运行以下命令以配置 Proxy（两台机器的 Proxy 配置相同）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">vi /etc/haproxy/haproxy.cfg
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-conf" data-lang="conf"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nv">global</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="nv">log</span> <span class="err">/</span><span class="nv">dev</span><span class="err">/</span><span class="nv">log</span>  <span class="nv">local0</span> <span class="nv">warning</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="nv">chroot</span>      <span class="err">/</span><span class="nv">var</span><span class="err">/</span><span class="nv">lib</span><span class="err">/</span><span class="nv">haproxy</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="nv">pidfile</span>     <span class="err">/</span><span class="nv">var</span><span class="err">/</span><span class="nv">run</span><span class="err">/</span><span class="nv">haproxy.pid</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="nv">maxconn</span>     <span class="nv">4000</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nv">user</span>        <span class="nv">haproxy</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="kt">group</span>       <span class="nv">haproxy</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="nv">daemon</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">   <span class="nv">stats</span> <span class="nv">socket</span> <span class="err">/</span><span class="nv">var</span><span class="err">/</span><span class="nv">lib</span><span class="err">/</span><span class="nv">haproxy</span><span class="err">/</span><span class="nv">stats</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nv">defaults</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="nv">log</span> <span class="nv">global</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">option</span>  <span class="nv">httplog</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">option</span>  <span class="nv">dontlognull</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">timeout</span> <span class="nv">connect</span> <span class="nv">5000</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="nv">timeout</span> <span class="nv">client</span> <span class="nv">50000</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nv">timeout</span> <span class="nv">server</span> <span class="nv">50000</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="nv">frontend</span> <span class="nv">kube-apiserver</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="nv">bind</span> <span class="err">*:</span><span class="nv">8443</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="nv">mode</span> <span class="nv">tcp</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">option</span> <span class="nv">tcplog</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="nv">default_backend</span> <span class="nv">kube-apiserver</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="nv">backend</span> <span class="nv">kube-apiserver</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="nv">mode</span> <span class="nv">tcp</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="k">option</span> <span class="nv">tcplog</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">option</span> <span class="nv">tcp-check</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="nv">balance</span> <span class="nv">roundrobin</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="nv">default-server</span> <span class="nv">inter</span> <span class="nv">10s</span> <span class="nv">downinter</span> <span class="nv">5s</span> <span class="nv">rise</span> <span class="nv">2</span> <span class="nv">fall</span> <span class="nv">2</span> <span class="nv">slowstart</span> <span class="nv">60s</span> <span class="nv">maxconn</span> <span class="nv">250</span> <span class="nv">maxqueue</span> <span class="nv">256</span> <span class="nv">weight</span> <span class="nv">100</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="nv">server</span> <span class="nv">kube-apiserver-1</span> <span class="mf">10.1.6.48</span><span class="err">:</span><span class="nv">6443</span> <span class="nv">check</span> <span class="c"># Replace the IP address with your own.
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="c"></span>    <span class="nv">server</span> <span class="nv">kube-apiserver-2</span> <span class="mf">10.1.6.24</span><span class="err">:</span><span class="nv">6443</span> <span class="nv">check</span> <span class="c"># Replace the IP address with your own.
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="c"></span>    <span class="nv">server</span> <span class="nv">kube-apiserver-3</span> <span class="mf">10.1.6.45</span><span class="err">:</span><span class="nv">6443</span> <span class="nv">check</span> <span class="c"># Replace the IP address with your own.
</span></span></span></code></pre></div><p>启动Haproxy</p>
<blockquote>
<p>请确保你的LB2也已经进行如上配置</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">systemctl restart haproxy
</span></span><span class="line"><span class="ln">2</span><span class="cl">systemctl <span class="nb">enable</span> haproxy
</span></span></code></pre></div><p>配置Keepalived
<code>KP1</code>配置如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">vim /etc/keepalived/keepalived.conf
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-conf" data-lang="conf"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nv">global_defs</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="nv">notification_email</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nv">router_id</span> <span class="nv">LVS_DEVEL</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="nv">vrrp_skip_check_adv_addr</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="nv">vrrp_garp_interval</span> <span class="nv">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="nv">vrrp_gna_interval</span> <span class="nv">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nv">vrrp_script</span> <span class="nv">chk_haproxy</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="nv">script</span> <span class="s">&#34;killall -0 haproxy&#34;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="nv">interval</span> <span class="nv">2</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="nv">weight</span> <span class="nv">2</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">vrrp_instance</span> <span class="nv">haproxy-vip</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="nv">state</span> <span class="nv">BACKUP</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="nv">priority</span> <span class="nv">100</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="nv">interface</span> <span class="nv">ens192</span>                      <span class="c"># 网卡名称
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c"></span>  <span class="nv">virtual_router_id</span> <span class="nv">60</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="nv">advert_int</span> <span class="nv">1</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="nv">authentication</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nv">auth_type</span> <span class="nv">PASS</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nv">auth_pass</span> <span class="nv">1111</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="nv">unicast_src_ip</span> <span class="mf">10.1.6.213</span>      <span class="c"># The IP address of this machine
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="c"></span>  <span class="nv">unicast_peer</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="mf">10.1.6.214</span>                  <span class="c"># The IP address of peer machines
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="c"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="nv">virtual_ipaddress</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="mf">10.1.6.215/24</span>                  <span class="c"># 虚拟IP地址
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="c"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="nv">track_script</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="nv">chk_haproxy</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>KP2</code>配置如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">vim /etc/keepalived/keepalived.conf
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-conf" data-lang="conf"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nv">global_defs</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="nv">notification_email</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nv">router_id</span> <span class="nv">LVS_DEVEL</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="nv">vrrp_skip_check_adv_addr</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="nv">vrrp_garp_interval</span> <span class="nv">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="nv">vrrp_gna_interval</span> <span class="nv">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nv">vrrp_script</span> <span class="nv">chk_haproxy</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="nv">script</span> <span class="s">&#34;killall -0 haproxy&#34;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="nv">interval</span> <span class="nv">2</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="nv">weight</span> <span class="nv">2</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">vrrp_instance</span> <span class="nv">haproxy-vip</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="nv">state</span> <span class="nv">BACKUP</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="nv">priority</span> <span class="nv">90</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="nv">interface</span> <span class="nv">ens192</span>                      <span class="c"># Network card
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c"></span>  <span class="nv">virtual_router_id</span> <span class="nv">60</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="nv">advert_int</span> <span class="nv">1</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="nv">authentication</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nv">auth_type</span> <span class="nv">PASS</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nv">auth_pass</span> <span class="nv">1111</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="nv">unicast_src_ip</span> <span class="mf">10.1.6.214</span>      <span class="c"># The IP address of this machine
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="c"></span>  <span class="nv">unicast_peer</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="mf">10.1.6.214</span>                         <span class="c"># The IP address of peer machines
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="c"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="nv">virtual_ipaddress</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="mf">10.1.6.215/24</span>                  <span class="c"># The VIP address
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="c"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="nv">track_script</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="nv">chk_haproxy</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>请确保你的<code>KP1</code>和<code>KP2</code>都完成了如上配置</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">systemctl start keepalived
</span></span><span class="line"><span class="ln">2</span><span class="cl">systemctl <span class="nb">enable</span> keepalived
</span></span></code></pre></div><h2 id="配置master主机节点的hosts文件">配置Master主机节点的Hosts文件</h2>
<ul>
<li>
<p>所有的Master主机都需要进行配置,防止后续解析不到<code>api.k8s.verbos.com</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-conf" data-lang="conf"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="mf">10.1.6.48</span> <span class="nv">containerd-master1</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="mf">10.1.6.24</span> <span class="nv">containerd-master2</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="mf">10.1.6.45</span> <span class="nv">containerd-master3</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mf">10.1.6.46</span> <span class="nv">containerd-work1</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mf">10.1.6.43</span> <span class="nv">containerd-work2</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mf">10.1.6.47</span> <span class="nv">containerd-work3</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mf">10.1.6.51</span> <span class="nv">etcd1</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="mf">10.1.6.52</span> <span class="nv">etcd2</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="mf">10.1.6.53</span> <span class="nv">etcd3</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="mf">10.1.6.215</span>  <span class="nv">api.k8s.verbos.com</span>
</span></span></code></pre></div><h3 id="设置etcd集群证书">设置Etcd集群证书</h3>
<p>如果你使用的是工作在Work节点的Etcd或者其他单独的Etcd集群,请将Etcd的<code>ca</code>证书进行拷贝到Master节点当中.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="nb">export</span> <span class="nv">CONTROL_PLANE</span><span class="o">=</span><span class="s2">&#34;root@10.1.6.48&#34;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">scp /etc/kubernetes/pki/etcd/ca.crt <span class="s2">&#34;</span><span class="si">${</span><span class="nv">CONTROL_PLANE</span><span class="si">}</span><span class="s2">&#34;</span>:
</span></span><span class="line"><span class="ln">3</span><span class="cl">scp /etc/kubernetes/pki/apiserver-etcd-client.crt <span class="s2">&#34;</span><span class="si">${</span><span class="nv">CONTROL_PLANE</span><span class="si">}</span><span class="s2">&#34;</span>:
</span></span><span class="line"><span class="ln">4</span><span class="cl">scp /etc/kubernetes/pki/apiserver-etcd-client.key <span class="s2">&#34;</span><span class="si">${</span><span class="nv">CONTROL_PLANE</span><span class="si">}</span><span class="s2">&#34;</span>:
</span></span></code></pre></div><h2 id="设置第一个控制平面节点">设置第一个控制平面节点</h2>
<p>用以下内容创建一个名为 <code>kubeadm-config.yaml</code> 的文件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeadm.k8s.io/v1beta3</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterConfiguration</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="nt">kubernetesVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1.22.10</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="nt">controlPlaneEndpoint</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;api.k8s.verbos.com:8443&#34;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="nt">apiServer</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">  </span><span class="nt">certSANs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span>- <span class="m">10.1.6.48</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span>- <span class="m">10.1.6.24</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span>- <span class="m">10.1.6.45</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">  </span><span class="nt">etcd</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">  </span><span class="nt">external</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">  </span><span class="nt">endpoints</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">  </span>- <span class="l">https://10.1.6.51:2379</span><span class="w"> </span><span class="c"># 适当地更改 ETCD_0_IP</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">  </span>- <span class="l">https://10.1.6.52:2379</span><span class="w"> </span><span class="c"># 适当地更改 ETCD_1_IP</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">  </span>- <span class="l">https://10.1.6.53:2379</span><span class="w"> </span><span class="c"># 适当地更改 ETCD_2_IP</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">    </span><span class="nt">caFile</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/kubernetes/pki/etcd/ca.crt</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">    </span><span class="nt">certFile</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/kubernetes/pki/apiserver-etcd-client.crt</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">    </span><span class="nt">keyFile</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/kubernetes/pki/apiserver-etcd-client.key</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">    </span><span class="nt">imageRepository</span><span class="p">:</span><span class="w"> </span><span class="l">registry.aliyuncs.com/google_containers</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">    </span><span class="nt">networking</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">    </span><span class="nt">podSubnet</span><span class="p">:</span><span class="w"> </span><span class="m">10.244.0.0</span><span class="l">/16</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">    </span><span class="nt">serviceSubnet</span><span class="p">:</span><span class="w"> </span><span class="m">10.10.0.0</span><span class="l">/16</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
<p>在节点上运行如下命令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">kubeadm init --config kubeadm-config.yaml --upload-certs --v<span class="o">=</span><span class="m">5</span>
</span></span></code></pre></div><blockquote>
<p>注意：如果你的集群初始化成功你将会看到如下信息.</p>
</blockquote>
<ul>
<li>请保存好<code>kubeadm join</code>的内容,默认2小时后过期,过期后重新生成即可</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">Your Kubernetes control-plane has initialized successfully!
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">To start using your cluster, you need to run the following as a regular user:
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">Alternatively, <span class="k">if</span> you are the root user, you can run:
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="nb">export</span> <span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">You should now deploy a pod network to the cluster.
</span></span><span class="line"><span class="ln">13</span><span class="cl">Run <span class="s2">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span class="line"><span class="ln">14</span><span class="cl">  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">You can now join any number of the control-plane node running the following <span class="nb">command</span> on each as root:
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">  kubeadm join api.k8s.verbos.com:8443 --token 9oerz0.fw6s8ft9xa44i077 <span class="se">\
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="se"></span>        --discovery-token-ca-cert-hash sha256:be3c70562ae6bf8cfcfbbfa3bb8124fe63af3b1a0671e806a4ccf1bc243d5c6b <span class="se">\
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="se"></span>        --control-plane --certificate-key cdf0f280f9e59e18e5f60d98b624008d828ba00ef096a2e38fd9b6b1463be152
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
</span></span><span class="line"><span class="ln">23</span><span class="cl">As a safeguard, uploaded-certs will be deleted in two hours<span class="p">;</span> If necessary, you can use
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="s2">&#34;kubeadm init phase upload-certs --upload-certs&#34;</span> to reload certs afterward.
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">Then you can join any number of worker nodes by running the following on each as root:
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">kubeadm join api.k8s.verbos.com:8443 --token 9oerz0.fw6s8ft9xa44i077 <span class="se">\
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="se"></span>        --discovery-token-ca-cert-hash sha256:be3c70562ae6bf8cfcfbbfa3bb8124fe63af3b1a0671e806a4ccf1bc243d5c6b 
</span></span></code></pre></div><p><strong>拷贝集群配置文件</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="ln">2</span><span class="cl">sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="ln">3</span><span class="cl">sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</span></span></code></pre></div><h2 id="运行网络cni插件calico">运行网络CNI插件(Calico)</h2>
<blockquote>
<p>注意：此时你应当有一个CNI插件来提供网络服务,如果不安装CNI插件,那么集群将会处于<code>不可用</code>状态.</p>
</blockquote>
<p>如果你可以正常访问github</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">[</span>root@containerd-kube-master .kube<span class="o">]</span><span class="c1"># curl https://raw.githubusercontent.com/projectcalico/calico/v3.24.1/manifests/calico.yaml -O</span>
</span></span></code></pre></div><p>国内用户</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">curl https://projectcalico.docs.tigera.io/manifests/calico.yaml -O
</span></span></code></pre></div><h3 id="修改calicoyaml配置">修改Calico.yaml配置</h3>
<p>修改CIDR为Kubernetes的子网地址,该地址为<code>serviceSubnet</code>的地址,也就是Pod运行的地址。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl">- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">CALICO_IPV4POOL_CIDR</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10.10.0.0/16&#34;</span><span class="w">
</span></span></span></code></pre></div><p>执行<code>calico.yaml</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">kubectl apply -f calico.yaml
</span></span></code></pre></div><h2 id="将其他控制平面节点加入集群">将其他控制平面节点加入集群</h2>
<p>当你已经确保你的<code>containerd-master1</code>完成初始化的时候,你可以将其他的master节点加入到此集群当中.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">  kubeadm join api.k8s.verbos.com:8443 --token 9oerz0.fw6s8ft9xa44i077 <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>        --discovery-token-ca-cert-hash sha256:be3c70562ae6bf8cfcfbbfa3bb8124fe63af3b1a0671e806a4ccf1bc243d5c6b <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>        --control-plane --certificate-key cdf0f280f9e59e18e5f60d98b624008d828ba00ef096a2e38fd9b6b1463be152
</span></span></code></pre></div><p>加入集群成功后,请拷贝集群配置文件否则将影响<code>kubelet</code>的工作</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="ln">2</span><span class="cl">sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="ln">3</span><span class="cl">sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</span></span></code></pre></div><h2 id="将工作节点加入集群">将工作节点加入集群</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">kubeadm join api.k8s.verbos.com:8443 --token mck9bg.renw4t689mmx7oe1 <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>        --discovery-token-ca-cert-hash sha256:ed51fca8615acf5f437f63f66a9709e43ef942caf19aea4c595cb905e4a9a00f
</span></span></code></pre></div><h2 id="可选项修改kubelet的数据存储目录">(可选项)修改Kubelet的数据存储目录</h2>
<p>如果你需要修改kubelet的数据存储目录,请按照如下方式进行操作</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">vim /etc/sysconfig/kubelet
</span></span></code></pre></div><p>设置你的kubelet的数据存储目录(建议单独的为kubelet挂载一块数据盘)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-conf" data-lang="conf"><span class="line"><span class="ln">1</span><span class="cl"><span class="nv">KUBELET_EXTRA_ARGS</span><span class="o">=</span><span class="s">&#34;--root-dir=/data/k8s/kubelet&#34;</span>
</span></span></code></pre></div><p>重启kubelet</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">systemctl daemon-reloa
</span></span><span class="line"><span class="ln">2</span><span class="cl">systemctl restart kubelet
</span></span><span class="line"><span class="ln">3</span><span class="cl">umount <span class="k">$(</span>df -HT <span class="p">|</span> grep <span class="s1">&#39;/var/lib/kubelet/pods&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $7}&#39;</span><span class="k">)</span>
</span></span></code></pre></div><p>查看新的数据目录是否有kubelet的数据</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">[</span>root@containerd-master2 kubelet<span class="o">]</span><span class="c1"># ls /data/k8s/kubelet/</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">cpu_manager_state  memory_manager_state  plugins  plugins_registry  pod-resources  pods
</span></span></code></pre></div><h2 id="如何剔除一个master">如何剔除一个Master</h2>
<ul>
<li>先说一个问题,当我们正常如果一个Master要进行某种升级的时候,如何正确的安全的来进行删除该Master。</li>
</ul>
<ol>
<li>首先我们要将该Master设置为不可调度的状态,并且驱逐在其上面的Pod</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 设置Master为不可调度的状态</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">kubectl cordon online-beijing-master1
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"># 将Master剔除该集群</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">kubectl drain online-beijing-master1 --ignore-daemonsets
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"># 然后将其节点从集群中删除</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">kubectl delete node online-beijing-master1
</span></span></code></pre></div><blockquote>
<p>这里提一个小问题: 当你使用<code>kubectl drain</code>的时候,如果你当前的Master已经有挂载的<code>emptyDir</code>需要使用<code>--delete-emptydir-data </code>进行删除。
TODO: 删除前请注意备份您的数据。</p>
</blockquote>


        </div>
<ul class="hb-blog-post-nav nav justify-content-between mb-3">
  
    <li class="nav-item my-1">
      <a class="nav-link p-0 d-flex align-items-center" href="/posts/kubernetes-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/"><svg aria-hidden="true" class="bi bi-arrow-left-circlebi bi-arrow-left-circle hi-svg-inline me-2" fill="currentColor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5z"/>
</svg>Kubernetes低版本中内存泄漏问题</a>
    </li>
  
  
    <li class="nav-item my-1">
      <a class="nav-link p-0 d-flex align-items-center" href="/posts/install-kubernetes/">kubernetes1.22.0单节点集群部署<svg aria-hidden="true" class="bi bi-arrow-right-circlebi bi-arrow-right-circle hi-svg-inline ms-2" fill="currentColor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0M4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5z"/>
</svg></a>
    </li>
  
</ul>






  <div id="content-comments" class="hb-blog-post-comments hb-module mb-3">
<div id="twikoo-comments"></div>


  </div>



      </div>
    </div>
    

  </div>
  <div class="hb-blog-sidebar pe-lg-1">
  
  <div
    class="hb-blog-sidebar-profile hb-module d-flex flex-column justify-content-center align-items-center">
      
      












  
  
    
    
    
    
    
    
    
    
    
    
    
    
  
    <picture>
    <source srcset="/images/avatar_hu3b524e9b8f8772a6019da4ead2865f01_9176_ab72abc4ab1538a4c57546e4ff08f6d1.webp" type="image/webp" />
  <img
    class="hb-blog-sidebar-profile-img rounded-circle img-fluid mb-3"
    src="https://blog.mletter.cn/images/avatar_hu3b524e9b8f8772a6019da4ead2865f01_9176_100x0_resize_box_3.d4ab93c1a773c431e0dd90cd83a48519.png"
    alt=""
    loading="lazy"
    height="100"
    width="100"
    
    
    
     />
</picture>

    <p class="hb-blog-sidebar-profile-title text-center h5 mb-2">
      人间只是春
    </p>
    <p class="hb-blog-sidebar-profile-desc text-center mb-2">
      喜马拉雅的山顶永远不会有万家灯火
    </p>
    <p class="hb-blog-sidebar-profile-meta mb-0">
        <span class="mx-1"><svg aria-hidden="true" class="bi bi-geo-altbi bi-geo-alt hi-svg-inline me-1" fill="currentColor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg">
  <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A32 32 0 0 1 8 14.58a32 32 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10"/>
  <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
</svg>China·HangZhou</span>
    </p>
      <div class="hb-footer-socials d-flex mb-0 mt-1 justify-content-center">
          
          
<a
  class="hb-social p-2"
  href="https://space.bilibili.com/%25!s%28int64=477276392%29"
  target="_blank"
  rel="nofollow me"
  title="Bilibili"><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentColor" height="1.75em" role="img" style="color: #fb7299;" viewBox="0 0 24 24" width="1.75em" xmlns="http://www.w3.org/2000/svg"><title>Bilibili</title><path d="M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"/></svg>
</a>

          
          
<a
  class="hb-social p-2"
  href="mailto:beilanzhisen@163.com"
  target="_blank"
  rel="nofollow me"
  title="Email"><svg aria-hidden="true" class="bi bi-envelope-fillbi bi-envelope-fill hi-svg-inline hb-social-icon" fill="currentColor" height="1.75em" style="color: %!s(bool=true);" viewBox="0 0 16 16" width="1.75em" xmlns="http://www.w3.org/2000/svg">
  <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414zM0 4.697v7.104l5.803-3.558zM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586zm3.436-.586L16 11.801V4.697z"/>
</svg>
</a>

      </div>
  </div>

  <div class="hb-blog-sidebar-posts hb-module">
    <ul class="nav nav-underline nav-fill" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="recent-posts-tab"
            data-bs-toggle="tab"
            data-bs-target="#recent-posts"
            type="button"
            role="tab"
            aria-controls="recent-posts"
            aria-selected="true">
            Recent
          </button>
        </li>
    </ul>

    <div class="tab-content mt-2">
        <div
          class="tab-pane slide active"
          id="recent-posts"
          role="tabpanel"
          aria-labelledby="recent-posts-tab"
          tabindex="0">
          
  <div class="slide">
  <div class="slide-inner row row-cols-1">
      <div class="slide-item px-0">
        
<div
  class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0">
    
<a
  class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2"
  href="/bulletin/2024/0108/">
    












  
  
    <picture>
  <img
    class="hb-blog-post-card-img"
    src="https://fc.sinaimg.cn/large/005Czbxjgy1hlmcj1fb04j31hc0u0u0x.jpg"
    alt="2024年站点更新内容通知"
    loading="lazy"
    
    
    
    
    
     />
</picture>

</a>

  <div class="card-body px-0 py-2 d-flex flex-column">
    <div class="hb-blog-post-title card-title h5 py-1">
      <a
        class="hb-blog-post-title-link d-block"
        title="2024年站点更新内容通知"
        href="/bulletin/2024/0108/">2024年站点更新内容通知</a>
    </div>
  </div>
</div>

      </div>
      <div class="slide-item px-0">
        
<div
  class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0">
    
<a
  class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2"
  href="/posts/kubernetes-efk/">
    












  
  
    <picture>
  <img
    class="hb-blog-post-card-img"
    src="https://fc.sinaimg.cn/large/005Czbxjgy1hkmevv8ozyj31ds0iqn0i.jpg"
    alt="kubernetes基于EFK的日志落地实现"
    loading="lazy"
    
    
    
    
    
     />
</picture>

</a>

  <div class="card-body px-0 py-2 d-flex flex-column">
    <div class="hb-blog-post-title card-title h5 py-1">
      <a
        class="hb-blog-post-title-link d-block"
        title="kubernetes基于EFK的日志落地实现"
        href="/posts/kubernetes-efk/">kubernetes基于EFK的日志落地实现</a>
    </div>
  </div>
</div>

      </div>
      <div class="slide-item px-0">
        
<div
  class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0">
    
<a
  class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2"
  href="/posts/%E5%B7%9D%E8%A5%BF%E4%B9%8B%E6%97%85/">
    












  
  
    <picture>
  <img
    class="hb-blog-post-card-img"
    src="https://img11.360buyimg.com/ddimg/jfs/t1/236840/40/3995/133210/6563505dFfe136e64/32c8465a255f4bc7.jpg"
    alt="旅行日记-四川·阿坝甘孜藏族自治州"
    loading="lazy"
    
    
    
    
    
     />
</picture>

</a>

  <div class="card-body px-0 py-2 d-flex flex-column">
    <div class="hb-blog-post-title card-title h5 py-1">
      <a
        class="hb-blog-post-title-link d-block"
        title="旅行日记-四川·阿坝甘孜藏族自治州"
        href="/posts/%E5%B7%9D%E8%A5%BF%E4%B9%8B%E6%97%85/">旅行日记-四川·阿坝甘孜藏族自治州</a>
    </div>
  </div>
</div>

      </div>
      <div class="slide-item px-0">
        
<div
  class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0">
    
<a
  class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2"
  href="/posts/kubernetes%E7%9A%84%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/">
    












  
  
    <picture>
  <img
    class="hb-blog-post-card-img"
    src="https://img13.360buyimg.com/ddimg/jfs/t1/164078/6/34165/22231/654ba81fFe1bf21d7/9d02bd791b795b3b.jpg"
    alt="Kubernetes的架构设计和对象属性基本理解"
    loading="lazy"
    
    
    
    
    
     />
</picture>

</a>

  <div class="card-body px-0 py-2 d-flex flex-column">
    <div class="hb-blog-post-title card-title h5 py-1">
      <a
        class="hb-blog-post-title-link d-block"
        title="Kubernetes的架构设计和对象属性基本理解"
        href="/posts/kubernetes%E7%9A%84%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/">Kubernetes的架构设计和对象属性基本理解</a>
    </div>
  </div>
</div>

      </div>
      <div class="slide-item px-0">
        
<div
  class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0">
    
<a
  class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2"
  href="/posts/wecho/">
    












  
  
    <picture>
  <img
    class="hb-blog-post-card-img"
    src="https://ydschool-online.nosdn.127.net/tiku/f291c1c8d5dccacd2b95ef4fdc68d07cefd0e92562794e5bcdd21a9729b3455d.jpg"
    alt="维扣-专属你的拍照摄影社区"
    loading="lazy"
    
    
    
    
    
     />
</picture>

</a>

  <div class="card-body px-0 py-2 d-flex flex-column">
    <div class="hb-blog-post-title card-title h5 py-1">
      <a
        class="hb-blog-post-title-link d-block"
        title="维扣-专属你的拍照摄影社区"
        href="/posts/wecho/"><span class="text-danger">
  <svg aria-hidden="true" class="bi bi-pinbi bi-pin hi-svg-inline me-1" fill="currentColor" height=".85em" viewBox="0 0 16 16" width=".85em" xmlns="http://www.w3.org/2000/svg">
  <path d="M4.146.146A.5.5 0 0 1 4.5 0h7a.5.5 0 0 1 .5.5c0 .68-.342 1.174-.646 1.479-.126.125-.25.224-.354.298v4.431l.078.048c.203.127.476.314.751.555C12.36 7.775 13 8.527 13 9.5a.5.5 0 0 1-.5.5h-4v4.5c0 .276-.224 1.5-.5 1.5s-.5-1.224-.5-1.5V10h-4a.5.5 0 0 1-.5-.5c0-.973.64-1.725 1.17-2.189A6 6 0 0 1 5 6.708V2.277a3 3 0 0 1-.354-.298C4.342 1.674 4 1.179 4 .5a.5.5 0 0 1 .146-.354m1.58 1.408-.002-.001zm-.002-.001.002.001A.5.5 0 0 1 6 2v5a.5.5 0 0 1-.276.447h-.002l-.012.007-.054.03a5 5 0 0 0-.827.58c-.318.278-.585.596-.725.936h7.792c-.14-.34-.407-.658-.725-.936a5 5 0 0 0-.881-.61l-.012-.006h-.002A.5.5 0 0 1 10 7V2a.5.5 0 0 1 .295-.458 1.8 1.8 0 0 0 .351-.271c.08-.08.155-.17.214-.271H5.14q.091.15.214.271a1.8 1.8 0 0 0 .37.282"/>
</svg>
</span>
维扣-专属你的拍照摄影社区</a>
    </div>
  </div>
</div>

      </div>
  </div>
  
<button class="slide-control-left">
  <svg aria-hidden="true" class="bi bi-arrow-left-circlebi bi-arrow-left-circle hi-svg-inline slide-control-left-icon" fill="currentColor" height="2em" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-4.5-.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5z"/>
</svg>
  <span class="visually-hidden">Left</span>
</button>
<button class="slide-control-right">
  <svg aria-hidden="true" class="bi bi-arrow-right-circlebi bi-arrow-right-circle hi-svg-inline slide-control-right-icon" fill="currentColor" height="2em" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0M4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5z"/>
</svg>
  <span class="visually-hidden">Right</span>
</button>

</div>


        </div>
    </div>
  </div>

  <div class="hb-blog-sidebar-taxonomies hb-module">
    
<ul class="nav nav-underline nav-justified mb-2" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="taxonomy-categories-tab"
        data-bs-toggle="tab"
        data-bs-target="#taxonomy-categories-tab-pane"
        type="button"
        role="tab"
        aria-controls="taxonomy-categories-tab-pane"
        aria-selected="true">Categories</button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="taxonomy-tags-tab"
        data-bs-toggle="tab"
        data-bs-target="#taxonomy-tags-tab-pane"
        type="button"
        role="tab"
        aria-controls="taxonomy-tags-tab-pane"
        aria-selected="false">Tags</button>
    </li>
</ul>
<div class="tab-content">
    <div
      class="tab-pane fade show active"
      id="taxonomy-categories-tab-pane"
      role="tabpanel"
      aria-labelledby="taxonomy-categories-tab"
      tabindex="0">
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/kubernetes/">
          <span class="taxonomy-term-title">kubernetes</span>
            <small class="taxonomy-term-count border rounded px-1">20</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/ansible/">
          <span class="taxonomy-term-title">ansible</span>
            <small class="taxonomy-term-count border rounded px-1">3</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/docker/">
          <span class="taxonomy-term-title">docker</span>
            <small class="taxonomy-term-count border rounded px-1">2</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/%E6%97%85%E8%A1%8C%E6%97%A5%E8%AE%B0/">
          <span class="taxonomy-term-title">旅行日记</span>
            <small class="taxonomy-term-count border rounded px-1">2</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/mysql/">
          <span class="taxonomy-term-title">mysql</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/nginx/">
          <span class="taxonomy-term-title">nginx</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/redis/">
          <span class="taxonomy-term-title">redis</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/">
          <span class="taxonomy-term-title">个人项目</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/%E5%B7%A5%E5%85%B7%E5%88%86%E4%BA%AB/">
          <span class="taxonomy-term-title">工具分享</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/categories/%E6%97%A5%E5%B8%B8%E6%91%84%E5%BD%B1/">
          <span class="taxonomy-term-title">日常摄影</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
    </div>
    <div
      class="tab-pane fade"
      id="taxonomy-tags-tab-pane"
      role="tabpanel"
      aria-labelledby="taxonomy-tags-tab"
      tabindex="0">
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/kubernetes/">
          <span class="taxonomy-term-title">kubernetes</span>
            <small class="taxonomy-term-count border rounded px-1">20</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/ansible/">
          <span class="taxonomy-term-title">ansible</span>
            <small class="taxonomy-term-count border rounded px-1">3</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/%E6%97%A5%E8%AE%B0/">
          <span class="taxonomy-term-title">日记</span>
            <small class="taxonomy-term-count border rounded px-1">3</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/docker/">
          <span class="taxonomy-term-title">docker</span>
            <small class="taxonomy-term-count border rounded px-1">2</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/api/">
          <span class="taxonomy-term-title">API</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/api-server/">
          <span class="taxonomy-term-title">api-server</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/configmap/">
          <span class="taxonomy-term-title">configmap</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/coredns/">
          <span class="taxonomy-term-title">coredns</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/dashboard/">
          <span class="taxonomy-term-title">dashboard</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
        <a
          class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1"
          href="/tags/etcd/">
          <span class="taxonomy-term-title">etcd</span>
            <small class="taxonomy-term-count border rounded px-1">1</small>
        </a>
    </div>
</div>

  </div>


</div>

</div>

    </div>
    

    <footer class="hb-footer pt-4 pt-md-5 pb-2 pb-md-3 bg-body-tertiary">
  <div class="container-fluid container-lg px-4 px-md-3">

    <div class="row"><div class="hb-footer-site-info col mb-2 text-center col-lg-3">

  <div class="h5">人生不过一场山川而已</div>
  <ul class="list-unstyled small mb-2">
  </ul>

</div>

  <div class="col-6 col-lg-2 offset-lg-1 mb-3">
    <div class="mb-3 d-flex align-items-center h5">Projects</div>
    <ul class="hb-footer-menus list-unstyled ms-1">
        <li class="mb-2">
          <a
            class="hb-footer-menu"
            href="https://apisix.apache.org/zh/"
            target="_blank"><svg aria-hidden="true" class="hi-svg-inline hb-footer-menu-icon me-2" fill="currentColor" height="1em" id="mdi-api" style="color: #F44336;" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M7 7H5A2 2 0 0 0 3 9V17H5V13H7V17H9V9A2 2 0 0 0 7 7M7 11H5V9H7M14 7H10V17H12V13H14A2 2 0 0 0 16 11V9A2 2 0 0 0 14 7M14 11H12V9H14M20 9V15H21V17H17V15H18V9H17V7H21V9Z" /></svg>APISIX</a>
        </li>
        <li class="mb-2">
          <a
            class="hb-footer-menu"
            href="https://kubernetes.io"
            target="_blank"><svg aria-hidden="true" class="hi-svg-inline hb-footer-menu-icon me-2" fill="currentColor" height="1em" id="mdi-ship-wheel" style="color: #03A9F4;" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2,11L4.05,11.1C4.3,8.83 5.5,6.85 7.25,5.56L6.13,3.84C5.86,3.36 6,2.75 6.5,2.47C7,2.2 7.59,2.36 7.87,2.84L8.8,4.66C9.78,4.24 10.86,4 12,4C13.14,4 14.22,4.24 15.2,4.66L16.13,2.84C16.41,2.36 17,2.2 17.5,2.47C18,2.75 18.14,3.36 17.87,3.84L16.75,5.56C18.5,6.85 19.7,8.83 19.95,11.1L22,11A1,1 0 0,1 23,12A1,1 0 0,1 22,13L19.95,12.9C19.7,15.17 18.5,17.15 16.75,18.44L17.87,20.16C18.14,20.64 18,21.25 17.5,21.53C17,21.8 16.41,21.64 16.13,21.16L15.2,19.34C14.22,19.76 13.14,20 12,20C10.86,20 9.78,19.76 8.8,19.34L7.87,21.16C7.59,21.64 7,21.8 6.5,21.53C6,21.25 5.86,20.64 6.13,20.16L7.25,18.44C5.5,17.15 4.3,15.17 4.05,12.9L2,13A1,1 0 0,1 1,12A1,1 0 0,1 2,11M9.07,11.35C9.2,10.74 9.53,10.2 10,9.79L8.34,7.25C7.11,8.19 6.27,9.6 6.05,11.2L9.07,11.35M12,9C12.32,9 12.62,9.05 12.9,9.14L14.28,6.45C13.58,6.16 12.81,6 12,6C11.19,6 10.42,6.16 9.72,6.45L11.1,9.14C11.38,9.05 11.68,9 12,9M14.93,11.35L17.95,11.2C17.73,9.6 16.89,8.19 15.66,7.25L14,9.79C14.47,10.2 14.8,10.74 14.93,11.35M14.93,12.65C14.8,13.26 14.47,13.8 14,14.21L15.66,16.75C16.89,15.81 17.73,14.4 17.95,12.8L14.93,12.65M12,15C11.68,15 11.38,14.95 11.09,14.86L9.72,17.55C10.42,17.84 11.19,18 12,18C12.81,18 13.58,17.84 14.28,17.55L12.91,14.86C12.62,14.95 12.32,15 12,15M9.07,12.65L6.05,12.8C6.27,14.4 7.11,15.81 8.34,16.75L10,14.21C9.53,13.8 9.2,13.26 9.07,12.65Z" /></svg>Kubernetes</a>
        </li>
    </ul>
  </div>

    </div>

  </div>
</footer>










<script
  src="/js/hb.js"
  
  defer></script>


  
<script src="https://cdn.bootcdn.net/ajax/libs/twikoo/1.6.16/twikoo.all.min.js"></script>
<script>
  twikoo.init({
    envId: 'https:\/\/twikoo.mletter.cn\/',
    el: '#twikoo-comments',
    region: '',
    path: location.pathname,
    lang: 'en'
  });
</script>







  





<script>
  if ('serviceWorker' in navigator) {
  window.addEventListener('DOMContentLoaded', function() {
    navigator.serviceWorker.register('\/sw.js');
  });
}
</script>

<script src="/js/search.js" defer></script>




  </body>
</html>
