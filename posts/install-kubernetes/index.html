<!doctype html><html data-bs-theme=light itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?display=swap&amp;family=+JetBrains+Mono&amp;family=JetBrains+Mono%3Aital%2Cwght%400%2C600%3B1%2C600..900" rel=stylesheet><link rel=manifest href=https://blog.mletter.cn/manifest.webmanifest><meta name=description content="kubeadm版部署kubernetes方案"><meta property="og:title" content="kubernetes1.22.0单节点集群部署"><meta property="og:description" content="kubeadm版部署kubernetes方案"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.mletter.cn/posts/install-kubernetes/"><meta property="og:image" content="https://fc.sinaimg.cn/large/005Czbxjgy1hlm862knaqj30sg0e875n.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-29T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-29T00:00:00+00:00"><meta itemprop=name content="kubernetes1.22.0单节点集群部署"><meta itemprop=description content="kubeadm版部署kubernetes方案"><meta itemprop=datePublished content="2022-12-29T00:00:00+00:00"><meta itemprop=dateModified content="2022-12-29T00:00:00+00:00"><meta itemprop=wordCount content="1083"><meta itemprop=image content="https://fc.sinaimg.cn/large/005Czbxjgy1hlm862knaqj30sg0e875n.jpg"><meta itemprop=keywords content="kubernetes,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fc.sinaimg.cn/large/005Czbxjgy1hlm862knaqj30sg0e875n.jpg"><meta name=twitter:title content="kubernetes1.22.0单节点集群部署"><meta name=twitter:description content="kubeadm版部署kubernetes方案"><title>kubernetes1.22.0单节点集群部署 - Posts -</title><link href="/css/hb.4caa23f100cace35f7c4334374263b9d071605f8e0756cc12bc2e421f42609c8.css" rel=stylesheet><script src=/js/init.b980cf5ff873691f491c400ab7f55079eb2d1eef456f2eec75db7cf3d8c9dcc7.js integrity="sha256-uYDPX/hzaR9JHEAKt/VQeestHu9Fby7sddt889jJ3Mc="></script></head><body><noscript><div class="alert alert-danger text-center rounded-0" role=alert><svg aria-hidden="true" class="bi bi-exclamation-square-fillbi bi-exclamation-square-fill hi-svg-inline me-2" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2 0A2 2 0 000 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2zm6 4c.535.0.954.462.9.995l-.35 3.507a.552.552.0 01-1.1.0L7.1 4.995A.905.905.0 018 4m.002 6a1 1 0 110 2 1 1 0 010-2"/></svg>Your browser does not support JavaScript.</div></noscript><header class=hb-header><nav class="hb-header-nav navbar navbar-expand-lg"><div class="hb-announcement-bar text-center px-1 py-2 w-100 overflow-hidden border-bottom border-secondary"><a class="hb-announcement text-decoration-none text-truncate active" href=/bulletin/2024/0108/>2024年本站大更新啦,查看更新内容轻点我哦<svg aria-hidden="true" class="bi bi-arrow-rightbi bi-arrow-right hi-svg-inline ms-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a.5.5.0 01.5-.5h11.793l-3.147-3.146a.5.5.0 01.708-.708l4 4a.5.5.0 010 .708l-4 4a.5.5.0 01-.708-.708L13.293 8.5H1.5A.5.5.0 011 8"/></svg></a></div><div class=container-fluid><a class="navbar-brand d-flex align-items-center" href=/>人间只是春</a><div class="d-flex order-5"><div class="search-modal-toggle hb-header-search-form position-relative d-flex ms-lg-1"><button type=button class="hb-header-search-icon border-0 bg-transparent px-2" aria-label="Toggle search"><svg aria-hidden="true" class="bi bi-searchbi bi-search hi-svg-inline" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.742 10.344a6.5 6.5.0 10-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 001.415-1.414l-3.85-3.85a1 1 0 00-.115-.1zM12 6.5a5.5 5.5.0 11-11 0 5.5 5.5.0 0111 0"/></svg></button>
<input class="form-control rounded-5 d-none d-lg-block ms-lg-1" placeholder=Search>
<span class="hb-header-search-keys position-absolute d-none d-lg-block"><kbd>CTRL</kbd>
<kbd>K</kbd></span></div><button class="navbar-toggler border-0 shadow-none" type=button data-bs-toggle=offcanvas data-bs-target=#hb-header-content aria-controls=hb-header-content aria-label="Toggle navigation"><svg aria-hidden="true" class="bi bi-three-dotsbi bi-three-dots hi-svg-inline" fill="currentcolor" height="1.25em" viewBox="0 0 16 16" width="1.25em" xmlns="http://www.w3.org/2000/svg"><path d="M3 9.5a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3m5 0a1.5 1.5.0 110-3 1.5 1.5.0 010 3"/></svg></button></div><div class="offcanvas offcanvas-lg offcanvas-end" tabindex=-1 id=hb-header-content aria-labelledby=hb-header-content-label><div class=offcanvas-header><h5 class=offcanvas-title id=hb-header-content-label>人间只是春</h5><button type=button class=btn-close data-bs-dismiss=offcanvas aria-label=Close></button></div><div class=offcanvas-body><ul class="hb-header-menus navbar-nav flex-row flex-wrap"></ul><ul class="hb-header-panel navbar-nav flex-row flex-wrap"><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><hr class="d-lg-none my-2 text-body-50"></li><li class="nav-item col-6 col-lg-auto d-flex align-items-center"><a class="hb-social btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-center align-items-center" href=beilanzhisen@163.com target=_blank rel="nofollow me" title=Gmail><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1em" role="img" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Gmail</title><path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636.0 010 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"/></svg><span class="hb-social-text d-lg-none ms-1">Gmail</span></a></li><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-body"></div><hr class="d-lg-none my-2 text-body-50"></li><li class="theme-toggle nav-item dropdown col-6 col-lg-auto d-flex flex-column justify-content-center"><a class="btn btn-link nav-link py-2 px-0 px-lg-2 d-flex justify-content-start justify-content-lg-center align-items-center" href=# role=button data-bs-toggle=dropdown aria-expanded=false><svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1 theme-toggle-icon" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 108 1zm0 1A8 8 0 118 0a8 8 0 010 16"/></svg><span class="d-lg-none ms-1">Theme</span></a><ul class="theme-toggle-menu dropdown-menu dropdown-menu-end"><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-value=auto>
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-circle-halfbi bi-circle-half hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 15A7 7 0 108 1zm0 1A8 8 0 118 0a8 8 0 010 16"/></svg></span>Auto</button></li><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-value=dark>
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-moon-starsbi bi-moon-stars hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.77.77.0 01.08.858 7.2 7.2.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79.0 01.81.316.73.73.0 01-.031.893A8.35 8.35.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.75.75.0 016 .278M4.858 1.311A7.27 7.27.0 001.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.32 7.32.0 005.205-2.162q-.506.063-1.029.063c-4.61.0-8.343-3.714-8.343-8.29.0-1.167.242-2.278.681-3.286"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.73 1.73.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.73 1.73.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.73 1.73.0 001.097-1.097zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.16 1.16.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.16 1.16.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732z"/></svg></span>Dark</button></li><li><button class="theme-toggle-item dropdown-item d-flex align-items-center justify-content-center" data-bs-theme-value=light>
<span class="theme-toggle-item-icon me-1 d-flex align-items-center"><svg aria-hidden="true" class="bi bi-brightness-highbi bi-brightness-high hi-svg-inline my-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 11a3 3 0 110-6 3 3 0 010 6m0 1a4 4 0 100-8 4 4 0 000 8M8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0m0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13m8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5M3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8m10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0m-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0m9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707M4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708"/></svg></span>Light</button></li></ul></li></ul></div></div></div></nav></header><div class="hb-main container hb-main container"><div class=hb-blog-main-container><div class=hb-blog-main><div class="container-fluid px-0 mb-4"><nav aria-label=breadcrumb><ol class="hb-breadcrumb breadcrumb"><li class=breadcrumb-item><a href=/ title>Home</a></li><li class=breadcrumb-item><a href=/posts/ title=Posts>Posts</a></li><li class="breadcrumb-item active" aria-current=page><a href=/posts/install-kubernetes/ title=kubernetes1.22.0单节点集群部署>kubernetes1.22.0单节点集群部署</a></li></ol></nav></div><div class="hb-blog-post position-relative"><div class="hb-blog-post-intro hb-module mb-2"><h1 class=hb-blog-post-title>kubernetes1.22.0单节点集群部署</h1><div class=hb-blog-post-meta><span class=hb-blog-post-date>December 29, 2022</span>
<span class=hb-blog-post-reading-time>6 min read</span>
<span class=hb-blog-post-taxonomy-meta><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-category badge bg-secondary text-decoration-none fw-normal me-1" href=/categories/kubernetes/>kubernetes</a></span>
<span class=hb-blog-post-taxonomy-meta><a class="hb-blog-post-taxonomy hb-blog-post-taxonomy-tag badge bg-secondary text-decoration-none fw-normal me-1" href=/tags/kubernetes/>kubernetes</a></span></div><div class="hb-blog-post-desc lead mt-1">kubeadm版部署kubernetes方案</div></div><div class="hb-blog-post-toc text-body-secondary position-sticky overflow-y-auto"><div class="hb-module pb-1"><div class="h6 d-none d-md-block">On this page</div><hr class="d-none d-md-block"><div class="d-grid d-block d-md-none mb-2"><button class="btn btn-light d-flex align-items-center justify-content-between collapsed" type=button data-bs-toggle=collapse data-bs-target=.hb-blog-post-toc-collapse aria-expanded=false aria-controls=collapse-toc>
<span>On this page</span><svg aria-hidden="true" class="bi bi-chevron-expandbi bi-chevron-expand hi-svg-inline ms-2" fill="currentcolor" height="1.25rem" viewBox="0 0 16 16" width="1.25rem" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3.646 9.146a.5.5.0 01.708.0L8 12.793l3.646-3.647a.5.5.0 01.708.708l-4 4a.5.5.0 01-.708.0l-4-4a.5.5.0 010-.708m0-2.292a.5.5.0 00.708.0L8 3.207l3.646 3.647a.5.5.0 00.708-.708l-4-4a.5.5.0 00-.708.0l-4 4a.5.5.0 000 .708"/></svg></button></div><div class="px-2 px-md-0"><div id=collapse-toc class="collapse hb-blog-post-toc-collapse"><nav id=TableOfContents><ul><li><a href=#kubernetes12210部署>kubernetes1.22.10部署</a></li><li><a href=#准备工作>准备工作</a><ul><li><a href=#我的服务器配置列表>我的服务器配置列表</a></li><li><a href=#需要开放的端口>需要开放的端口</a></li><li><a href=#准备主机地址>准备主机地址</a></li><li><a href=#关闭swap分区以及防火墙>关闭swap分区以及防火墙</a></li></ul></li><li><a href=#containerd的基础安装和操作>Containerd的基础安装和操作</a><ul><li><a href=#通过阿里云镜像源安装>通过阿里云镜像源安装</a></li><li><a href=#生成containerd的配置文件>生成containerd的配置文件</a></li><li><a href=#修改sandbox_img>修改sandbox_img</a></li><li><a href=#修改systemd-cgroup驱动>修改Systemd Cgroup驱动</a></li><li><a href=#设置crictl-查找的容器运行时>设置Crictl 查找的容器运行时</a></li><li><a href=#额外-设置containerd的私有仓库>(额外) 设置Containerd的私有仓库</a></li><li><a href=#启动containerd>启动containerd</a></li><li><a href=#配置ipv4转发>配置IPV4转发</a></li></ul></li><li><a href=#kubernetes安装>kubernetes安装</a><ul><li><a href=#通过阿里云镜像源安装-1>通过阿里云镜像源安装</a></li><li><a href=#安装命令提示>安装命令提示</a></li><li><a href=#启动kubelet>启动kubelet</a></li><li><a href=#初始化集群配置信息>初始化集群配置信息</a></li><li><a href=#创建admin配置目录>创建admin配置目录</a></li><li><a href=#创建集群网络>创建集群网络</a></li><li><a href=#加入集群>加入集群</a></li><li><a href=#验证集群>验证集群</a></li><li><a href=#提一个小问题>提一个小问题</a></li></ul></li><li><a href=#问题解决>问题解决</a><ul><li><a href=#使用crictl-image出现warn0000-image-connect-using-default-endpoints>使用crictl image出现<code>WARN[0000] image connect using default endpoints</code></a></li><li><a href=#master主集群加入token过期如何处理>Master主集群加入token过期如何处理</a></li></ul></li></ul></nav></div></div></div></div><div class=hb-blog-post-main><div class="hb-module p-0 text-center"><picture><img class="hb-featured-img img-fluid p-1 bg-body-secondary border w-100" src=https://fc.sinaimg.cn/large/005Czbxjgy1hlm862knaqj30sg0e875n.jpg alt=kubernetes1.22.0单节点集群部署></picture></div><div class="hb-blog-post-content hb-module"><h2 id=kubernetes12210部署>kubernetes1.22.10部署</h2><h2 id=准备工作>准备工作</h2><ul><li>兼容的 Linux 主机。Kubernetes 项目为基于 Debian 和 Red Hat 的 Linux 发行版以及那些没有包管理器的发行版提供了通用说明。</li><li>每台机器 2 GB 或更多 RAM（任何更少都会为您的应用程序留下很小的空间）。</li><li>2 个 CPU 或更多。</li><li>集群中所有机器之间的完整网络连接（公共或专用网络都可以）。</li><li>每个节点的唯一主机名、MAC 地址和 product_uuid。有关更多详细信息，请参见<a href=https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#verify-mac-address target=_blank rel="noopener noreferrer">此处</a>。</li><li>您的机器上的某些端口是开放的。有关更多详细信息，请参见<a href=https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports target=_blank rel="noopener noreferrer">此处</a>。</li><li>交换Swap分区。必须禁用Swap才能使 kubelet 正常工作。</li></ul><h3 id=我的服务器配置列表>我的服务器配置列表</h3><p>没有必要按照我的这个配置去操作个人建议实验环境：正常演示环境2核2G就够了</p><h3 id=需要开放的端口>需要开放的端口</h3><p>虽然 etcd 端口包含在控制平面部分，但您也可以在外部或自定义端口上托管自己的 etcd 集群。
可以覆盖所有默认端口号。当使用自定义端口时，这些端口需要打开而不是此处提到的默认值。
一个常见的例子是 API 服务器端口，有时会切换到 443。或者，默认端口保持原样，API 服务器放在负载均衡器后面，该负载均衡器监听 443 并将请求路由到默认端口上的 API 服务器。</p><h3 id=准备主机地址>准备主机地址</h3><ul><li>修改每一台主机的<code>/etc/hosts</code>配置</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=c1># vim /etc/hosts</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>10.1.6.45 containerd-kube-master
</span></span><span class=line><span class=ln>3</span><span class=cl>10.1.6.46 containerd-kube-work1
</span></span><span class=line><span class=ln>4</span><span class=cl>10.1.6.47 containerd-kube-work2
</span></span></code></pre></div><h3 id=关闭swap分区以及防火墙>关闭swap分区以及防火墙</h3><p>进入<code>fstab</code>后找到你挂载的swap分区注释即可.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@bogon ~<span class=o>]</span><span class=c1># swapoff -a</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># echo &#34;vm.swappiness = 0&#34; &gt;&gt; /etc/sysctl.conf</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=o>[</span>root@bogon ~<span class=o>]</span><span class=c1># vim /etc/fstab</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1># /dev/mapper/rl-swap     none                    swap    defaults        0 0</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># systemctl stop firewalld &amp;&amp; systemctl disable firewalld # 关闭并且禁用防火墙</span>
</span></span></code></pre></div><p>所有内容准备完成后重启三台服务器!</p><h2 id=containerd的基础安装和操作>Containerd的基础安装和操作</h2><p>本文档后续基于<code>Containerd</code>+<code>RockyLinux</code>+<code>Kubeadmin</code>部署Kubernetes1.24版本的环境。</p><ul><li><a href=https://containerd.io/ target=_blank rel="noopener noreferrer">containerd</a></li><li><a href=https://www.docker.com/ target=_blank rel="noopener noreferrer">Docker</a></li><li><a href=https://cri-o.io/ target=_blank rel="noopener noreferrer">CRI-O</a></li></ul><p>需要注意的是,根据Kubernetes官方给出的公告。Kubernetes 1.20x版本将会废弃对<code>Docker的支持</code></p><ul><li><a href=https://%20/github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-%201.20.md%20#deprecation target=_blank rel="noopener noreferrer">参考连接</a></li></ul><h3 id=通过阿里云镜像源安装>通过阿里云镜像源安装</h3><ul><li><a href=https://developer.aliyun.com/mirror/ target=_blank rel="noopener noreferrer">官方镜像站</a></li><li>三台主机全部执行此操作</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># yum install -y yum-utils device-mapper-persistent-data lvm2</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># yum -y install containerd.io</span>
</span></span></code></pre></div><p>查看一下<code>containerd</code>的版本</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># containerd -v</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>containerd containerd.io 1.6.8 9cd3357b7fd7218e4aec3eae239db1f68a5a6ec6
</span></span></code></pre></div><h3 id=生成containerd的配置文件>生成containerd的配置文件</h3><ul><li>三台主机全部执行此操作
默认情况下在<code>/etc/containerd/config.toml</code>已经有这个文件了,但是里面是一些简短的配置.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># mkdir - /etc/containerd/</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># containerd config default | tee /etc/containerd/config.toml # 生成contained的默认配置</span>
</span></span></code></pre></div><h3 id=修改sandbox_img>修改sandbox_img</h3><ul><li><code>pause</code>： 此镜像是kubernetes的基础容器</li><li>三台主机全部执行此操作
由于部分用户无法进入<code>k8s.gcr.io</code>资源地址,需要对此地址进行替换.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=ln>1</span><span class=cl><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>containerd-kube-master</span> <span class=nx>containerd</span><span class=p>]</span><span class=c># vim /etc/containerd/config.toml</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nx>sandbox_image</span> <span class=p>=</span> <span class=s2>&#34;k8s.gcr.io/pause:3.6&#34;</span>  <span class=c># 找到此选项并且修改为: registry.aliyuncs.com/google_containers/pause:3.6</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>containerd</span><span class=p>.</span><span class=nx>default_runtime</span><span class=p>]</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>  <span class=nx>runtime_type</span> <span class=p>=</span> <span class=s2>&#34;io.containerd.runtime.v1.linux&#34;</span><span class=c># 修改为io.containerd.runtime.v1.linux</span>
</span></span></code></pre></div><h3 id=修改systemd-cgroup驱动>修改Systemd Cgroup驱动</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=ln>1</span><span class=cl><span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>containerd</span><span class=p>.</span><span class=nx>runtimes</span><span class=p>.</span><span class=nx>runc</span><span class=p>.</span><span class=nx>options</span><span class=p>]</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=nx>SystemdCgroup</span> <span class=p>=</span> <span class=kc>true</span>
</span></span></code></pre></div><p>然后重启<code>containerd</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl> systemctl restart containerd
</span></span></code></pre></div><h3 id=设置crictl-查找的容器运行时>设置Crictl 查找的容器运行时</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>crictl config runtime-endpoint unix:///var/run/containerd/containerd.sock
</span></span></code></pre></div><h3 id=额外-设置containerd的私有仓库>(额外) 设置Containerd的私有仓库</h3><p>如果你想用自己的私有仓库的话，可以通过如下方式进行设定</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=ln> 1</span><span class=cl><span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>image_decryption</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=nx>key_model</span> <span class=p>=</span> <span class=s2>&#34;node&#34;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>registry</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=nx>config_path</span> <span class=p>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>registry</span><span class=p>.</span><span class=nx>auths</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>registry</span><span class=p>.</span><span class=nx>configs</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>registry</span><span class=p>.</span><span class=nx>configs</span><span class=p>.</span><span class=s2>&#34;10.1.6.15&#34;</span><span class=p>.</span><span class=nx>auth</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>	   <span class=nx>username</span> <span class=p>=</span> <span class=s2>&#34;&#34;</span> <span class=c># 私有仓库账号</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>	   <span class=nx>password</span> <span class=p>=</span> <span class=s2>&#34;&#34;</span> <span class=c># 私有仓库密码</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>registry</span><span class=p>.</span><span class=nx>headers</span><span class=p>]</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>registry</span><span class=p>.</span><span class=nx>mirrors</span><span class=p>]</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=p>[</span><span class=nx>plugins</span><span class=p>.</span><span class=s2>&#34;io.containerd.grpc.v1.cri&#34;</span><span class=p>.</span><span class=nx>registry</span><span class=p>.</span><span class=nx>mirrors</span><span class=p>.</span><span class=s2>&#34;10.1.6.15&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>	<span class=nx>endpoint</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span> <span class=c># 私有仓库地址</span>
</span></span></code></pre></div><h3 id=启动containerd>启动containerd</h3><ul><li>三台主机全部执行此操作
保证<code>Active: active(running)</code>的状态即可</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># systemctl restart containerd</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># systemctl enable containerd</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># systemctl status containerd</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>● containerd.service - containerd container runtime
</span></span><span class=line><span class=ln> 5</span><span class=cl>   Loaded: loaded <span class=o>(</span>/usr/lib/systemd/system/containerd.service<span class=p>;</span> disabled<span class=p>;</span> vendor preset: disabled<span class=o>)</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>   Active: active <span class=o>(</span>running<span class=o>)</span> since Mon 2022-09-05 02:53:02 EDT<span class=p>;</span> 6s ago
</span></span><span class=line><span class=ln> 7</span><span class=cl>     Docs: &lt;https://containerd.io&gt;
</span></span><span class=line><span class=ln> 8</span><span class=cl>  Process: <span class=m>8465</span> <span class=nv>ExecStartPre</span><span class=o>=</span>/sbin/modprobe overlay <span class=o>(</span><span class=nv>code</span><span class=o>=</span>exited, <span class=nv>status</span><span class=o>=</span>0/SUCCESS<span class=o>)</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl> Main PID: <span class=m>8467</span> <span class=o>(</span>containerd<span class=o>)</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    Tasks: <span class=m>12</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>   Memory: 25.2M
</span></span><span class=line><span class=ln>12</span><span class=cl>   CGroup: /system.slice/containerd.service
</span></span><span class=line><span class=ln>13</span><span class=cl>           └─8467 /usr/bin/containerd
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master containerd<span class=o>[</span>8467<span class=o>]</span>: <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-09-05T02:53:02.159619104-04:00&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Start subscribing containerd event&#34;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master containerd<span class=o>[</span>8467<span class=o>]</span>: <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-09-05T02:53:02.159662811-04:00&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Start recovering state&#34;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master containerd<span class=o>[</span>8467<span class=o>]</span>: <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-09-05T02:53:02.159718042-04:00&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Start event monitor&#34;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master containerd<span class=o>[</span>8467<span class=o>]</span>: <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-09-05T02:53:02.159737174-04:00&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Start snapshots syncer&#34;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master containerd<span class=o>[</span>8467<span class=o>]</span>: <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-09-05T02:53:02.159750064-04:00&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Start cni network conf syncer for default&#34;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master containerd<span class=o>[</span>8467<span class=o>]</span>: <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-09-05T02:53:02.159756351-04:00&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Start streaming server&#34;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master containerd<span class=o>[</span>8467<span class=o>]</span>: <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-09-05T02:53:02.159868546-04:00&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span>serving... <span class=nv>address</span><span class=o>=</span>/run/containerd/containerd.sock.ttrpc
</span></span><span class=line><span class=ln>22</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master containerd<span class=o>[</span>8467<span class=o>]</span>: <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-09-05T02:53:02.159906215-04:00&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span>serving... <span class=nv>address</span><span class=o>=</span>/run/containerd/containerd.sock
</span></span><span class=line><span class=ln>23</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master containerd<span class=o>[</span>8467<span class=o>]</span>: <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-09-05T02:53:02.160196660-04:00&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;containerd successfully booted in 0.021144s&#34;</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>Sep <span class=m>05</span> 02:53:02 containerd-kube-master systemd<span class=o>[</span>1<span class=o>]</span>: Started containerd container runtime.
</span></span></code></pre></div><h3 id=配置ipv4转发>配置IPV4转发</h3><ul><li>三台全部执行</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl>cat <span class=s>&lt;&lt;EOF | tee /etc/modules-load.d/kubernetes1.24.conf
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=s>overlay
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=s>br_netfilter
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>cat <span class=s>&lt;&lt;EOF | tee /etc/sysctl.d/kubernetes1.24-forsys.conf
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=s>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=s>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=s>net.ipv4.ip_forward = 1
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># modprobe br_netfilter</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># sysctl --system</span>
</span></span></code></pre></div><h2 id=kubernetes安装>kubernetes安装</h2><p>kubernetes的安装依旧是基于aliyun</p><h3 id=通过阿里云镜像源安装-1>通过阿里云镜像源安装</h3><ul><li>三台全部安装
由于官网未开放同步方式, 可能会有索引gpg检查失败的情况, 这时请用 <code>yum install -y --nogpgcheck kubelet kubeadm kubectl</code> 安装</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=s>[kubernetes]
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=s>name=Kubernetes
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=s>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=s>enabled=1
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=s>gpgcheck=1
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=s>repo_gpgcheck=1
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=s>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=o>[</span>root@containerd-kube-work1 ~<span class=o>]</span><span class=c1># yum install -y kubelet-1.22.10 kubeadm-1.22.10 kubectl-1.22.10</span>
</span></span></code></pre></div><p>可以通过<code>yum --showduplicates list kubelet</code>查看当前仓库中可用的版本</p><h3 id=安装命令提示>安装命令提示</h3><p>安装后可以使用tab进行快捷提示</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># yum -y install bash-completion</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># source &lt;(kubeadm completion bash) &amp;&amp; source &lt;(kubectl completion bash)</span>
</span></span></code></pre></div><p>如果你想要<code>永久</code>的使其生效,请把他们加入到<code>.bashrc</code>当中</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=nb>cd</span> ~
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># vim .bashrc</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1># .bashrc</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1># User specific aliases and functions</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nb>alias</span> <span class=nv>rm</span><span class=o>=</span><span class=s1>&#39;rm -i&#39;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nb>alias</span> <span class=nv>cp</span><span class=o>=</span><span class=s1>&#39;cp -i&#39;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nb>alias</span> <span class=nv>mv</span><span class=o>=</span><span class=s1>&#39;mv -i&#39;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1># Source global definitions</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=k>if</span> <span class=o>[</span> -f /etc/bashrc <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>        . /etc/bashrc
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=nb>source</span> &lt;<span class=o>(</span>kubeadm completion bash<span class=o>)</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=nb>source</span> &lt;<span class=o>(</span>kubectl completion bash<span class=o>)</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=nb>source</span> &lt;<span class=o>(</span>crictl completion bash<span class=o>)</span>
</span></span></code></pre></div><h3 id=启动kubelet>启动kubelet</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># systemctl enable kubelet</span>
</span></span></code></pre></div><h3 id=初始化集群配置信息>初始化集群配置信息</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># kubeadm config print init-defaults &gt; init.yaml</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kubeadm.k8s.io/v1beta3</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>bootstrapTokens</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w></span>- <span class=nt>groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span>- <span class=l>system:bootstrappers:kubeadm:default-node-token</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>abcdef.0123456789abcdef</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span><span class=nt>ttl</span><span class=p>:</span><span class=w> </span><span class=l>24h0m0s</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>usages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span>- <span class=l>signing</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>  </span>- <span class=l>authentication</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>InitConfiguration</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w></span><span class=nt>localAPIEndpoint</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>  </span><span class=nt>advertiseAddress</span><span class=p>:</span><span class=w> </span><span class=m>10.1.6.45</span><span class=w> </span><span class=c># 初始化的第一台master主机的地址</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>  </span><span class=nt>bindPort</span><span class=p>:</span><span class=w> </span><span class=m>6443</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w></span><span class=nt>nodeRegistration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>  </span><span class=nt>criSocket</span><span class=p>:</span><span class=w> </span><span class=l>unix:///var/run/containerd/containerd.sock</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>  </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes-master</span><span class=w> </span><span class=c># 定义主机的唯一名称</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>  </span><span class=nt>taints</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=w></span><span class=nt>apiServer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=w>  </span><span class=nt>timeoutForControlPlane</span><span class=p>:</span><span class=w> </span><span class=l>4m0s</span><span class=w>
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kubeadm.k8s.io/v1beta3</span><span class=w>
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=w></span><span class=nt>certificatesDir</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/pki</span><span class=w>
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=w></span><span class=nt>clusterName</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes</span><span class=w>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=w></span><span class=nt>controllerManager</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=w></span><span class=nt>dns</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=w></span><span class=nt>etcd</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=w>  </span><span class=nt>local</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=w>    </span><span class=nt>dataDir</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/etcd</span><span class=w>
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=w></span><span class=nt>imageRepository</span><span class=p>:</span><span class=w> </span><span class=l>registry.aliyuncs.com/google_containers</span><span class=w> </span><span class=c># 修改为阿里云地址</span><span class=w>
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterConfiguration</span><span class=w>
</span></span></span><span class=line><span class=ln>32</span><span class=cl><span class=w></span><span class=nt>kubernetesVersion</span><span class=p>:</span><span class=w> </span><span class=m>1.22.10</span><span class=w>
</span></span></span><span class=line><span class=ln>33</span><span class=cl><span class=w></span><span class=nt>networking</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=w>  </span><span class=nt>dnsDomain</span><span class=p>:</span><span class=w> </span><span class=l>cluster.local</span><span class=w>
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=w>  </span><span class=nt>serviceSubnet</span><span class=p>:</span><span class=w> </span><span class=m>10.96.0.0</span><span class=l>/12  </span><span class=w> </span><span class=c># Pod使用的子网地址</span><span class=w>
</span></span></span><span class=line><span class=ln>36</span><span class=cl><span class=w></span><span class=nt>scheduler</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># kubeadm init --config=init.yaml   # 等待镜像Pull完成</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=o>[</span>init<span class=o>]</span> Using Kubernetes version: v1.24.0
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=o>[</span>preflight<span class=o>]</span> Running pre-flight checks
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=o>[</span>preflight<span class=o>]</span> Pulling images required <span class=k>for</span> setting up a Kubernetes cluster
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=o>[</span>preflight<span class=o>]</span> This might take a minute or two, depending on the speed of your internet connection
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=o>[</span>preflight<span class=o>]</span> You can also perform this action in beforehand using <span class=s1>&#39;kubeadm config images pull&#39;</span>
</span></span></code></pre></div><h3 id=创建admin配置目录>创建admin配置目录</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># mkdir -p $HOME/.kube</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># sudo chown $(id -u):$(id -g) $HOME/.kube/config</span>
</span></span></code></pre></div><h3 id=创建集群网络>创建集群网络</h3><p>因为flannel不支持网络隔离,所以不想用了!</p><ul><li>不再基于<code>flannel</code>,而是基于<code>calico</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master .kube<span class=o>]</span><span class=c1># curl https://raw.githubusercontent.com/projectcalico/calico/v3.24.1/manifests/calico.yaml -O</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1># --&gt;这个地址好像是用不了了,现在404了...</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>curl https://projectcalico.docs.tigera.io/manifests/calico.yaml -O
</span></span></code></pre></div><p>编辑<code>calico.yaml</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>CALICO_IPV4POOL_CIDR</span><span class=w> </span><span class=c># 修改CIDR为Kubernetes的子网地址,即初始化集群的serviceSubnet</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;10.96.0.0/12&#34;</span><span class=w>
</span></span></span></code></pre></div><p>创建<code>calico</code>网络</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># kubectl apply -f calico.yaml</span>
</span></span></code></pre></div><h3 id=加入集群>加入集群</h3><p>如果初始化成功会出现<code>Your Kubernetes control-plane has initialized successfully!</code></p><ul><li>在node节点执行</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-work1 containerd<span class=o>]</span><span class=c1># kubeadm join 10.1.6.45:6443 --token abcdef.0123456789abcdef \\</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>        --discovery-token-ca-cert-hash sha256:417d4385cc4f0cc572b106a6a13bf59fd865421f12a401f3660afa6ca19e500d
</span></span></code></pre></div><h3 id=验证集群>验证集群</h3><p>查看master节点的<code>Pod</code>是否全部启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># kubectl get pods --all-namespaces</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>NAMESPACE     NAME                                        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=ln> 3</span><span class=cl>kube-system   calico-kube-controllers-6799f5f4b4-pf8w8    1/1     Running   <span class=m>0</span>          2m16s
</span></span><span class=line><span class=ln> 4</span><span class=cl>kube-system   calico-node-lzcjk                           1/1     Running   <span class=m>0</span>          54s
</span></span><span class=line><span class=ln> 5</span><span class=cl>kube-system   calico-node-mrqkd                           1/1     Running   <span class=m>0</span>          2m16s
</span></span><span class=line><span class=ln> 6</span><span class=cl>kube-system   calico-node-r45bc                           1/1     Running   <span class=m>0</span>          71s
</span></span><span class=line><span class=ln> 7</span><span class=cl>kube-system   coredns-74586cf9b6-gkmbl                    1/1     Running   <span class=m>0</span>          2m37s
</span></span><span class=line><span class=ln> 8</span><span class=cl>kube-system   coredns-74586cf9b6-tgh6f                    1/1     Running   <span class=m>0</span>          2m37s
</span></span><span class=line><span class=ln> 9</span><span class=cl>kube-system   etcd-kubernetes-master                      1/1     Running   <span class=m>2</span>          2m42s
</span></span><span class=line><span class=ln>10</span><span class=cl>kube-system   kube-apiserver-kubernetes-master            1/1     Running   <span class=m>2</span>          2m43s
</span></span><span class=line><span class=ln>11</span><span class=cl>kube-system   kube-controller-manager-kubernetes-master   1/1     Running   <span class=m>2</span>          2m43s
</span></span><span class=line><span class=ln>12</span><span class=cl>kube-system   kube-proxy-mx4bg                            1/1     Running   <span class=m>0</span>          54s
</span></span><span class=line><span class=ln>13</span><span class=cl>kube-system   kube-proxy-ssw98                            1/1     Running   <span class=m>0</span>          71s
</span></span><span class=line><span class=ln>14</span><span class=cl>kube-system   kube-proxy-tpgfj                            1/1     Running   <span class=m>0</span>          2m38s
</span></span><span class=line><span class=ln>15</span><span class=cl>kube-system   kube-scheduler-kubernetes-master            1/1     Running   <span class=m>2</span>          2m43s
</span></span></code></pre></div><p>从master上查看节点是否已经全部<code>Ready</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># kubectl get nodes</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>NAME                    STATUS   ROLES           AGE     VERSION
</span></span><span class=line><span class=ln>3</span><span class=cl>containerd-kube-work1   Ready    &lt;none&gt;          55s     v1.24.2
</span></span><span class=line><span class=ln>4</span><span class=cl>containerd-kube-work2   Ready    &lt;none&gt;          38s     v1.24.2
</span></span><span class=line><span class=ln>5</span><span class=cl>containerd-kube-master  Ready    control-plane   2m29s   v1.24.2
</span></span></code></pre></div><p>到此为止,1.24的kubernetes已经安装完毕</p><h3 id=提一个小问题>提一个小问题</h3><p>看一下你们的<code>coredns</code>是否在同一个节点上,如果在同一个节点上,建议重新分配一下coredns保证其高可用性</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># kubectl get pods --all-namespaces -o wide</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>NAMESPACE     NAME                                        READY   STATUS    RESTARTS   AGE   IP            NODE                    NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=ln>3</span><span class=cl>kube-system   coredns-74586cf9b6-gkmbl                    1/1     Running   <span class=m>0</span>          32m   10.105.56.1   kubernetes-master       &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=ln>4</span><span class=cl>kube-system   coredns-74586cf9b6-tgh6f                    1/1     Running   <span class=m>0</span>          32m   10.105.56.3   kubernetes-master       &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>重新分配<code>coredns</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># kubectl --namespace kube-system rollout restart deployment coredns</span>
</span></span></code></pre></div><h2 id=问题解决>问题解决</h2><h3 id=使用crictl-image出现warn0000-image-connect-using-default-endpoints>使用crictl image出现<code>WARN[0000] image connect using default endpoints</code></h3><ul><li>出现该问题的原因是由于crictl不知道使用那个<code>sock</code>导致的</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master ~<span class=o>]</span><span class=c1># crictl image</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>WARN<span class=o>[</span>0000<span class=o>]</span> image connect using default endpoints: <span class=o>[</span>unix:///var/run/dockershim.sock unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock<span class=o>]</span>. As the default settings are now deprecated, you should <span class=nb>set</span> the endpoint instead.
</span></span></code></pre></div><blockquote><p>解决方法如下</p></blockquote><ul><li>默认情况下<code>containerd</code>的<code>sock</code>存放于<code>/run/containerd/containerd.sock</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=ln>1</span><span class=cl><span class=c># 重新设置一下使用的runtime-endpoint</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nx>crictl</span> <span class=nx>config</span> <span class=nx>runtime-endpoint</span> <span class=nx>unix</span><span class=err>:///</span><span class=nx>run</span><span class=err>/</span><span class=nx>containerd</span><span class=err>/</span><span class=nx>containerd</span><span class=p>.</span><span class=nx>sock</span>
</span></span></code></pre></div><p>默认生成的<code>crictl</code>存放在<code>/etc/crictl.yaml</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># vim /etc/crictl.yaml</span>
</span></span></code></pre></div><p>编辑配置文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>runtime-endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;unix:///run/containerd/containerd.sock&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w></span><span class=nt>image-endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;unix:///run/containerd/containerd.sock&#34;</span><span class=w> </span><span class=c># 新版本增加了image-endpoint需要手动更改</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w></span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w></span><span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span><span class=nt>pull-image-on-create</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w></span><span class=nt>disable-pull-on-run</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># systemctl daemon-reload</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=o>[</span>root@containerd-kube-master containerd<span class=o>]</span><span class=c1># crictl image</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>IMAGE               TAG                 IMAGE ID            SIZE
</span></span></code></pre></div><h3 id=master主集群加入token过期如何处理>Master主集群加入token过期如何处理</h3><ul><li>默认情况下,该token只有24小时,如果token值过期的话需要重新生成</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>--discovery-token-ca-cert-hash sha256:793106d3b4305808d55c3cdb211f89a768bec86ecef64264b131dc8f2548da16
</span></span></code></pre></div><ol><li>查看当前master集群的token列表</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master .kube<span class=o>]</span><span class=c1># kubeadm token list</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>TOKEN                     TTL         EXPIRES                USAGES                   DESCRIPTION                                                EXTRA GROUPS
</span></span><span class=line><span class=ln>3</span><span class=cl>abcdef.0123456789abcdef   8h          2022-09-06T10:10:05Z   authentication,signing   &lt;none&gt;                                                     system:bootstrappers:kubeadm:default-node-token
</span></span></code></pre></div><ol start=2><li>重新生成一份token</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master .kube<span class=o>]</span><span class=c1># kubeadm token create</span>
</span></span></code></pre></div><ol start=3><li>通过证书hashtokne</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=o>[</span>root@containerd-kube-master .kube<span class=o>]</span><span class=c1># openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#39;s/^.* //&#39;</span>
</span></span></code></pre></div></div><ul class="hb-blog-post-nav nav justify-content-between mb-3"><li class="nav-item my-1"><a class="nav-link p-0 d-flex align-items-center" href=/posts/install-kubernetes-ha/><svg aria-hidden="true" class="bi bi-arrow-left-circlebi bi-arrow-left-circle hi-svg-inline me-2" fill="currentcolor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0m-4.5-.5a.5.5.0 010 1H5.707l2.147 2.146a.5.5.0 01-.708.708l-3-3a.5.5.0 010-.708l3-3a.5.5.0 11.708.708L5.707 7.5z"/></svg>利用Kubeadm进行多Master高可用部署</a></li><li class="nav-item my-1"><a class="nav-link p-0 d-flex align-items-center" href=/posts/%E6%97%85%E8%A1%8C%E6%97%A5%E8%AE%B0-%E8%B7%A8%E5%B9%B4%E5%A4%A9%E6%B4%A5/>旅行日记-跨年•天津<svg aria-hidden="true" class="bi bi-arrow-right-circlebi bi-arrow-right-circle hi-svg-inline ms-2" fill="currentcolor" height="1.5em" viewBox="0 0 16 16" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0M4.5 7.5a.5.5.0 000 1h5.793l-2.147 2.146a.5.5.0 00.708.708l3-3a.5.5.0 000-.708l-3-3a.5.5.0 10-.708.708L10.293 7.5z"/></svg></a></li></ul><div id=content-comments class="hb-blog-post-comments hb-module mb-3"><div id=twikoo-comments></div></div></div></div></div><div class="hb-blog-sidebar pe-lg-1"><div class="hb-blog-sidebar-profile hb-module d-flex flex-column justify-content-center align-items-center"><picture><source srcset=/images/avatar_hu3b524e9b8f8772a6019da4ead2865f01_9176_ab72abc4ab1538a4c57546e4ff08f6d1.webp type=image/webp><img class="hb-blog-sidebar-profile-img rounded-circle img-fluid mb-3" src=https://blog.mletter.cn/images/avatar_hu3b524e9b8f8772a6019da4ead2865f01_9176_100x0_resize_box_3.d4ab93c1a773c431e0dd90cd83a48519.png alt loading=lazy height=100 width=100></picture><p class="hb-blog-sidebar-profile-title text-center h5 mb-2">人间只是春</p><p class="hb-blog-sidebar-profile-desc text-center mb-2">喜马拉雅的山顶永远不会有万家灯火</p><p class="hb-blog-sidebar-profile-meta mb-0"><span class=mx-1><svg aria-hidden="true" class="bi bi-geo-altbi bi-geo-alt hi-svg-inline me-1" fill="currentcolor" height="1em" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A32 32 0 018 14.58a32 32 0 01-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0110 0c0 .862-.305 1.867-.834 2.94M8 16s6-5.686 6-10A6 6 0 002 6c0 4.314 6 10 6 10"/><path d="M8 8a2 2 0 110-4 2 2 0 010 4m0 1a3 3 0 100-6 3 3 0 000 6"/></svg>China·HangZhou</span></p><div class="hb-footer-socials d-flex mb-0 mt-1 justify-content-center"><a class="hb-social p-2" href="https://space.bilibili.com/%25!s%28int64=477276392%29" target=_blank rel="nofollow me" title=Bilibili><svg aria-hidden="true" class="hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" role="img" style="color:#fb7299" viewBox="0 0 24 24" width="1.75em" xmlns="http://www.w3.org/2000/svg"><title>Bilibili</title><path d="M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858.0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234.0 01-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373s.653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836.0 01.16-.213l2.853-2.747c.267-.249.573-.373.92-.373s.662.151.929.4.391.551.391.907c0 .355-.124.657-.373.906zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773zM8 11.107c.373.0.684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373.0.684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373z"/></svg></a><a class="hb-social p-2" href=mailto:beilanzhisen@163.com target=_blank rel="nofollow me" title=Email><svg aria-hidden="true" class="bi bi-envelope-fillbi bi-envelope-fill hi-svg-inline hb-social-icon" fill="currentcolor" height="1.75em" style="color:%!s(bool=true)" viewBox="0 0 16 16" width="1.75em" xmlns="http://www.w3.org/2000/svg"><path d="M.05 3.555A2 2 0 012 2h12a2 2 0 011.95 1.555L8 8.414zM0 4.697v7.104l5.803-3.558zM6.761 8.83.191 12.857A2 2 0 002 14h12a2 2 0 001.808-1.144l-6.57-4.027L8 9.586zm3.436-.586L16 11.801V4.697z"/></svg></a></div></div><div class="hb-blog-sidebar-posts hb-module"><ul class="nav nav-underline nav-fill" role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=recent-posts-tab data-bs-toggle=tab data-bs-target=#recent-posts type=button role=tab aria-controls=recent-posts aria-selected=true>
Recent</button></li></ul><div class="tab-content mt-2"><div class="tab-pane slide active" id=recent-posts role=tabpanel aria-labelledby=recent-posts-tab tabindex=0><div class=slide><div class="slide-inner row row-cols-1"><div class="slide-item px-0"><div class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0"><a class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2" href=/bulletin/2024/0108/><picture><img class=hb-blog-post-card-img src=https://fc.sinaimg.cn/large/005Czbxjgy1hlmcj1fb04j31hc0u0u0x.jpg alt=2024年站点更新内容通知 loading=lazy></picture></a><div class="card-body px-0 py-2 d-flex flex-column"><div class="hb-blog-post-title card-title h5 py-1"><a class="hb-blog-post-title-link d-block" title=2024年站点更新内容通知 href=/bulletin/2024/0108/>2024年站点更新内容通知</a></div></div></div></div><div class="slide-item px-0"><div class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0"><a class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2" href=/posts/kubernetes-efk/><picture><img class=hb-blog-post-card-img src=https://fc.sinaimg.cn/large/005Czbxjgy1hkmevv8ozyj31ds0iqn0i.jpg alt=kubernetes基于EFK的日志落地实现 loading=lazy></picture></a><div class="card-body px-0 py-2 d-flex flex-column"><div class="hb-blog-post-title card-title h5 py-1"><a class="hb-blog-post-title-link d-block" title=kubernetes基于EFK的日志落地实现 href=/posts/kubernetes-efk/>kubernetes基于EFK的日志落地实现</a></div></div></div></div><div class="slide-item px-0"><div class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0"><a class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2" href=/posts/%E5%B7%9D%E8%A5%BF%E4%B9%8B%E6%97%85/><picture><img class=hb-blog-post-card-img src=https://img11.360buyimg.com/ddimg/jfs/t1/236840/40/3995/133210/6563505dFfe136e64/32c8465a255f4bc7.jpg alt=旅行日记-四川·阿坝甘孜藏族自治州 loading=lazy></picture></a><div class="card-body px-0 py-2 d-flex flex-column"><div class="hb-blog-post-title card-title h5 py-1"><a class="hb-blog-post-title-link d-block" title=旅行日记-四川·阿坝甘孜藏族自治州 href=/posts/%E5%B7%9D%E8%A5%BF%E4%B9%8B%E6%97%85/>旅行日记-四川·阿坝甘孜藏族自治州</a></div></div></div></div><div class="slide-item px-0"><div class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0"><a class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2" href=/posts/kubernetes%E7%9A%84%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/><picture><img class=hb-blog-post-card-img src=https://img13.360buyimg.com/ddimg/jfs/t1/164078/6/34165/22231/654ba81fFe1bf21d7/9d02bd791b795b3b.jpg alt=Kubernetes的架构设计和对象属性基本理解 loading=lazy></picture></a><div class="card-body px-0 py-2 d-flex flex-column"><div class="hb-blog-post-title card-title h5 py-1"><a class="hb-blog-post-title-link d-block" title=Kubernetes的架构设计和对象属性基本理解 href=/posts/kubernetes%E7%9A%84%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/>Kubernetes的架构设计和对象属性基本理解</a></div></div></div></div><div class="slide-item px-0"><div class="hb-blog-post-card card border-0 overflow-hidden h-100 bg-transparent mb-0"><a class="card-img-top overflow-hidden border border-secondary-subtle text-body text-decoration-none mt-2" href=/posts/wecho/><picture><img class=hb-blog-post-card-img src=https://ydschool-online.nosdn.127.net/tiku/f291c1c8d5dccacd2b95ef4fdc68d07cefd0e92562794e5bcdd21a9729b3455d.jpg alt=维扣-专属你的拍照摄影社区 loading=lazy></picture></a><div class="card-body px-0 py-2 d-flex flex-column"><div class="hb-blog-post-title card-title h5 py-1"><a class="hb-blog-post-title-link d-block" title=维扣-专属你的拍照摄影社区 href=/posts/wecho/><span class=text-danger><svg aria-hidden="true" class="bi bi-pinbi bi-pin hi-svg-inline me-1" fill="currentcolor" height=".85em" viewBox="0 0 16 16" width=".85em" xmlns="http://www.w3.org/2000/svg"><path d="M4.146.146A.5.5.0 014.5.0h7a.5.5.0 01.5.5c0 .68-.342 1.174-.646 1.479-.126.125-.25.224-.354.298v4.431l.078.048c.203.127.476.314.751.555C12.36 7.775 13 8.527 13 9.5a.5.5.0 01-.5.5h-4v4.5c0 .276-.224 1.5-.5 1.5s-.5-1.224-.5-1.5V10h-4A.5.5.0 013 9.5c0-.973.64-1.725 1.17-2.189A6 6 0 015 6.708V2.277a3 3 0 01-.354-.298C4.342 1.674 4 1.179 4 .5a.5.5.0 01.146-.354m1.58 1.408-.002-.001zm-.002-.001.002.001A.5.5.0 016 2v5a.5.5.0 01-.276.447h-.002l-.012.007-.054.03a5 5 0 00-.827.58c-.318.278-.585.596-.725.936h7.792c-.14-.34-.407-.658-.725-.936a5 5 0 00-.881-.61l-.012-.006h-.002A.5.5.0 0110 7V2a.5.5.0 01.295-.458 1.8 1.8.0 00.351-.271c.08-.08.155-.17.214-.271H5.14q.091.15.214.271a1.8 1.8.0 00.37.282"/></svg></span>维扣-专属你的拍照摄影社区</a></div></div></div></div></div><button class=slide-control-left><svg aria-hidden="true" class="bi bi-arrow-left-circlebi bi-arrow-left-circle hi-svg-inline slide-control-left-icon" fill="currentcolor" height="2em" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0m-4.5-.5a.5.5.0 010 1H5.707l2.147 2.146a.5.5.0 01-.708.708l-3-3a.5.5.0 010-.708l3-3a.5.5.0 11.708.708L5.707 7.5z"/></svg>
<span class=visually-hidden>Left</span></button>
<button class=slide-control-right><svg aria-hidden="true" class="bi bi-arrow-right-circlebi bi-arrow-right-circle hi-svg-inline slide-control-right-icon" fill="currentcolor" height="2em" viewBox="0 0 16 16" width="2em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1 8a7 7 0 1014 0A7 7 0 001 8m15 0A8 8 0 110 8a8 8 0 0116 0M4.5 7.5a.5.5.0 000 1h5.793l-2.147 2.146a.5.5.0 00.708.708l3-3a.5.5.0 000-.708l-3-3a.5.5.0 10-.708.708L10.293 7.5z"/></svg>
<span class=visually-hidden>Right</span></button></div></div></div></div><div class="hb-blog-sidebar-taxonomies hb-module"><ul class="nav nav-underline nav-justified mb-2" role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=taxonomy-categories-tab data-bs-toggle=tab data-bs-target=#taxonomy-categories-tab-pane type=button role=tab aria-controls=taxonomy-categories-tab-pane aria-selected=true>Categories</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomy-tags-tab data-bs-toggle=tab data-bs-target=#taxonomy-tags-tab-pane type=button role=tab aria-controls=taxonomy-tags-tab-pane aria-selected=false>Tags</button></li></ul><div class=tab-content><div class="tab-pane fade show active" id=taxonomy-categories-tab-pane role=tabpanel aria-labelledby=taxonomy-categories-tab tabindex=0><a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/kubernetes/><span class=taxonomy-term-title>kubernetes</span>
<small class="taxonomy-term-count border rounded px-1">20</small></a>
<a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/ansible/><span class=taxonomy-term-title>ansible</span>
<small class="taxonomy-term-count border rounded px-1">3</small></a>
<a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/docker/><span class=taxonomy-term-title>docker</span>
<small class="taxonomy-term-count border rounded px-1">2</small></a>
<a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/%E6%97%85%E8%A1%8C%E6%97%A5%E8%AE%B0/><span class=taxonomy-term-title>旅行日记</span>
<small class="taxonomy-term-count border rounded px-1">2</small></a>
<a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/mysql/><span class=taxonomy-term-title>mysql</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/nginx/><span class=taxonomy-term-title>nginx</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/redis/><span class=taxonomy-term-title>redis</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/><span class=taxonomy-term-title>个人项目</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/%E5%B7%A5%E5%85%B7%E5%88%86%E4%BA%AB/><span class=taxonomy-term-title>工具分享</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-categories btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/categories/%E6%97%A5%E5%B8%B8%E6%91%84%E5%BD%B1/><span class=taxonomy-term-title>日常摄影</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a></div><div class="tab-pane fade" id=taxonomy-tags-tab-pane role=tabpanel aria-labelledby=taxonomy-tags-tab tabindex=0><a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/kubernetes/><span class=taxonomy-term-title>kubernetes</span>
<small class="taxonomy-term-count border rounded px-1">20</small></a>
<a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/ansible/><span class=taxonomy-term-title>ansible</span>
<small class="taxonomy-term-count border rounded px-1">3</small></a>
<a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/%E6%97%A5%E8%AE%B0/><span class=taxonomy-term-title>日记</span>
<small class="taxonomy-term-count border rounded px-1">3</small></a>
<a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/docker/><span class=taxonomy-term-title>docker</span>
<small class="taxonomy-term-count border rounded px-1">2</small></a>
<a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/api/><span class=taxonomy-term-title>API</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/api-server/><span class=taxonomy-term-title>api-server</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/configmap/><span class=taxonomy-term-title>configmap</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/coredns/><span class=taxonomy-term-title>coredns</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/dashboard/><span class=taxonomy-term-title>dashboard</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a>
<a class="taxonomy-term taxonomy-term-tags btn btn-sm btn-outline-secondary p-1 me-1 mb-1" href=/tags/etcd/><span class=taxonomy-term-title>etcd</span>
<small class="taxonomy-term-count border rounded px-1">1</small></a></div></div></div></div></div></div><footer class="hb-footer pt-4 pt-md-5 pb-2 pb-md-3 bg-body-tertiary"><div class="container-fluid container-lg px-4 px-md-3"><div class=row><div class="hb-footer-site-info col mb-2 text-center"><div class=h5>人生不过一场山川而已</div><ul class="list-unstyled small mb-2"></ul></div></div></div></footer><script src=/js/hb.45b92db4c9e744e95404d884107b20bb2451a48955649f6af550b240c3b548c5.js integrity="sha256-RbkttMnnROlUBNiEEHsguyRRpIlVZJ9q9VCyQMO1SMU=" defer></script>
<script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script>
<script>twikoo.init({envId:"",el:"#twikoo-comments",region:"",path:location.pathname,lang:"en"})</script><script>"serviceWorker"in navigator&&window.addEventListener("DOMContentLoaded",function(){navigator.serviceWorker.register("/sw.js")})</script><script src=/js/search.ca3f08bec50140ac47f971d6d5d40cd7532cc253f971950506c848ed218fef3f.js defer></script></body></html>