---
import PageLayout from "@/layouts/Base.astro";
import Twikoo from "@/components/Twikoo.astro";
import linksData from "@/content/links.json";
import { Icon } from "astro-icon/components";

const meta = {
	title: "å‹æƒ…é“¾æ¥",
	description: "Moment Collector çš„å‹æƒ…é“¾æ¥é¡µé¢ï¼Œæ”¶å½•äº†ä¸€äº›ä¼˜ç§€çš„åšå®¢å’Œç½‘ç«™",
};

// ç”³è¯·å‹é“¾çš„ JSON æ¨¡æ¿
const friendLinkTemplate = `{
  "name": "æ‚¨çš„åšå®¢åç§°",
  "intro": "ä¸€å¥è¯ç®€ä»‹",
  "link": "https://your-blog.com",
  "avatar": "https://your-avatar-url.png"
}`;
---

<PageLayout meta={meta}>
	<!-- 1. åŠ¨æ€å‘¼å¸èƒŒæ™¯ (ä¿æŒå…¨ç«™ç»Ÿä¸€) -->
	<div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
		<div class="animate-blob absolute top-0 right-0 w-[70vw] h-[70vw] md:w-[45rem] md:h-[45rem] translate-x-1/3 -translate-y-1/3 bg-gradient-to-b from-purple-100/40 via-pink-50/20 to-transparent rounded-full blur-[100px] opacity-50 dark:from-purple-900/20 dark:via-pink-900/10 dark:opacity-30 mix-blend-multiply dark:mix-blend-screen"></div>
		<div class="animate-blob animation-delay-4000 absolute bottom-0 left-0 w-[60vw] h-[60vw] md:w-[40rem] md:h-[40rem] -translate-x-1/3 translate-y-1/3 bg-gradient-to-tr from-blue-100/30 via-teal-50/20 to-transparent rounded-full blur-[100px] opacity-40 dark:from-blue-900/20 dark:opacity-20 mix-blend-multiply dark:mix-blend-screen"></div>
	</div>

	<div class="max-w-5xl mx-auto px-4 sm:px-6 pb-20">
		
		<!-- Header Section -->
		<header class="text-center mb-16 pt-8 animate-fade-in-up opacity-0" style="animation-fill-mode: forwards;">
			<h1 class="text-4xl md:text-5xl font-bold mb-6 tracking-tight text-accent-two">
				å‹æƒ…é“¾æ¥
			</h1>
		</header>

		<!-- Links Groups -->
		<div class="space-y-16">
			{linksData.friends.map((group, groupIndex) => (
				<section class="animate-fade-in-up opacity-0" style={`animation-fill-mode: forwards; animation-delay: ${(groupIndex + 1) * 200}ms;`}>
					<div class="flex items-center gap-3 mb-8">
						<span class="w-1.5 h-8 bg-accent-two rounded-full"></span>
						<h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100">
							{group.desc}
						</h2>
						<span class="px-2.5 py-0.5 text-xs font-medium text-gray-500 bg-gray-100 dark:bg-white/10 rounded-full">
							{group.link_list.length}
						</span>
					</div>

					{group.link_list.length === 0 ? (
						<div class="text-center py-12 rounded-2xl border border-dashed border-gray-200 dark:border-white/10 bg-gray-50/50 dark:bg-white/5">
							<p class="text-gray-500 dark:text-gray-400">æš‚æ—¶è¿˜æ²¡æœ‰é“¾æ¥å“¦ ~</p>
						</div>
					) : (
						<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
							{group.link_list.map((friend) => (
								<a
									href={friend.link}
									target="_blank"
									rel="noopener noreferrer"
									class="group relative flex items-center gap-4 p-4 rounded-xl bg-white/60 dark:bg-gray-800/40 backdrop-blur-md border border-white/40 dark:border-white/5 transition-all duration-300 hover:bg-white/90 dark:hover:bg-gray-800/80 hover:border-accent-two/40 hover:shadow-sm"
								>
									<div class="flex-shrink-0">
										<img
											src={friend.avatar}
											alt={friend.name}
											class="w-12 h-12 rounded-full object-cover bg-gray-100 dark:bg-gray-900 border border-gray-100 dark:border-white/5 transition-opacity duration-300 group-hover:opacity-90"
											loading="lazy"
											onerror="this.src='https://img13.360buyimg.com/ddimg/jfs/t1/339806/2/18159/60207/68e72b0aF0cd09e9e/f498b59838834b98.jpg'"
										/>
									</div>
									<div class="flex-1 min-w-0">
										<h3 class="font-bold text-gray-800 dark:text-gray-200 group-hover:text-accent-two transition-colors duration-200 truncate text-base">
											{friend.name}
										</h3>
										<p class="text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-1">
											{friend.intro || "æš‚æ— ç®€ä»‹"}
										</p>
									</div>
									<!-- Link Icon (Subtle) -->
									<div class="text-gray-300 dark:text-gray-600 group-hover:text-accent-two/50 transition-colors">
										<Icon name="mdi:link-variant" class="w-4 h-4" />
									</div>
								</a>
							))}
						</div>
					)}
				</section>
			))}
		</div>

		<!-- Application Section -->
		<div class="mt-20 animate-fade-in-up opacity-0 animation-delay-500" style="animation-fill-mode: forwards;">
			<h2 class="text-2xl font-bold text-center mb-8 text-gray-800 dark:text-gray-100">ğŸ¤ ç”³è¯·å‹é“¾</h2>
			
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<!-- Option 1: Email -->
				<div class="p-6 rounded-2xl bg-white/50 dark:bg-gray-800/30 border border-gray-200 dark:border-white/10 backdrop-blur-sm flex flex-col items-center justify-center text-center">
					<div class="w-12 h-12 rounded-full bg-blue-50 dark:bg-blue-900/20 text-blue-500 flex items-center justify-center mb-4">
						<Icon name="mdi:email-outline" class="w-6 h-6" />
					</div>
					<h3 class="font-semibold text-lg mb-2">é‚®ä»¶ç”³è¯·</h3>
					<p class="text-sm text-gray-500 dark:text-gray-400 mb-6 max-w-xs">
						å¦‚æœæ‚¨æ›´ä¹ æƒ¯ä½¿ç”¨é‚®ä»¶ï¼Œå¯ä»¥ç›´æ¥å‘é€å‹é“¾ä¿¡æ¯åˆ°æˆ‘çš„é‚®ç®±ã€‚
					</p>
					<a href="mailto:beilanzhisen@163.com" class="px-6 py-2 text-sm font-medium text-white bg-accent-two rounded-full hover:bg-accent-two/90 transition-colors">
						beilanzhisen@163.com
					</a>
				</div>

				<!-- Option 2: Comment -->
				<div class="p-6 rounded-2xl bg-white/50 dark:bg-gray-800/30 border border-gray-200 dark:border-white/10 backdrop-blur-sm">
					<div class="flex items-center gap-3 mb-4">
						<div class="w-10 h-10 rounded-full bg-green-50 dark:bg-green-900/20 text-green-500 flex items-center justify-center">
							<Icon name="mdi:comment-text-outline" class="w-5 h-5" />
						</div>
						<div>
							<h3 class="font-semibold text-lg">è¯„è®ºåŒºç”³è¯·</h3>
							<p class="text-xs text-gray-500">å¤åˆ¶ä¸‹æ–¹æ ¼å¼åœ¨è¯„è®ºåŒºç•™è¨€</p>
						</div>
					</div>
					
					<!-- Code Block -->
					<div class="relative group">
						<pre class="bg-gray-50 dark:bg-black/20 rounded-lg p-4 text-xs text-gray-600 dark:text-gray-300 font-mono overflow-x-auto border border-gray-100 dark:border-white/5">{friendLinkTemplate}</pre>
						<button 
							id="copy-template-btn"
							class="absolute top-2 right-2 px-2 py-1 text-xs bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors text-gray-500 dark:text-gray-300"
							aria-label="Copy template"
						>
							å¤åˆ¶
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- è¯„è®ºåˆ†éš”çº¿ -->
		<div class="comments-separator mt-16 mb-12 animate-fade-in-up opacity-0 animation-delay-500" style="animation-fill-mode: forwards;">
			<div class="relative flex items-center py-4">
				<div class="flex-grow border-t border-gray-200 dark:border-white/10"></div>
				<span class="flex-shrink-0 mx-4 text-sm text-gray-500 font-medium px-4 py-1.5 bg-gray-50 dark:bg-white/5 rounded-full border border-gray-100 dark:border-white/10">
					ç•™è¨€åŒº ğŸ’¬
				</span>
				<div class="flex-grow border-t border-gray-200 dark:border-white/10"></div>
			</div>
		</div>

		<!-- è¯„è®ºç»„ä»¶ -->
		<div class="animate-fade-in-up opacity-0 animation-delay-500" style="animation-fill-mode: forwards;">
			<Twikoo />
		</div>
	</div>

	<script define:vars={{ friendLinkTemplate }}>
		// ç®€å•çš„å¤åˆ¶åŠŸèƒ½é€»è¾‘
		const copyBtn = document.getElementById('copy-template-btn');
		if (copyBtn) {
			copyBtn.addEventListener('click', async () => {
				try {
					await navigator.clipboard.writeText(friendLinkTemplate);
					const originalText = copyBtn.innerText;
					copyBtn.innerText = 'å·²å¤åˆ¶!';
					copyBtn.classList.add('text-green-600', 'border-green-600');
					
					setTimeout(() => {
						copyBtn.innerText = originalText;
						copyBtn.classList.remove('text-green-600', 'border-green-600');
					}, 2000);
				} catch (err) {
					console.error('Failed to copy text: ', err);
					copyBtn.innerText = 'å¤åˆ¶å¤±è´¥';
				}
			});
		}
	</script>

	<style>
		/* ä¼˜é›…çš„å…¥åœºåŠ¨ç”» */
		@keyframes fade-in-up {
			0% { opacity: 0; transform: translateY(20px); } /* å‡å°‘ä½ç§»è·ç¦»ï¼Œæ›´ç¨³é‡ */
			100% { opacity: 1; transform: translateY(0); }
		}
		
		.animate-fade-in-up {
			animation: fade-in-up 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
		}

		/* å‘¼å¸å…‰æ–‘ */
		@keyframes blob {
			0% { transform: translate(0px, 0px) scale(1); }
			33% { transform: translate(30px, -50px) scale(1.1); }
			66% { transform: translate(-20px, 20px) scale(0.95); }
			100% { transform: translate(0px, 0px) scale(1); }
		}
		
		.animate-blob {
			animation: blob 25s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
		}

		/* åŠ¨ç”»å»¶è¿Ÿå·¥å…·ç±» */
		.animation-delay-200 { animation-delay: 0.2s; }
		.animation-delay-500 { animation-delay: 0.5s; }
		.animation-delay-4000 { animation-delay: 4s; }
	</style>
</PageLayout>