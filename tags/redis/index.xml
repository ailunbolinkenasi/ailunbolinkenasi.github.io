<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>redis on</title><link>https://blog.mletter.cn/tags/redis/</link><description>Recent content in redis on</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Fri, 19 Feb 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.mletter.cn/tags/redis/index.xml" rel="self" type="application/rss+xml"/><item><title>Redis集群搭建</title><link>https://blog.mletter.cn/posts/redis-cluster/</link><pubDate>Fri, 19 Feb 2021 00:00:00 +0000</pubDate><guid>https://blog.mletter.cn/posts/redis-cluster/</guid><description>Redis Cluster（Redis集群）简介 redis是一个开源的key value存储系统，受到了广大互联网公司的青睐。redis3.0版本之前只支持单例模式，在3.0版本及以后才支持集群，我这里用的是redis3.0.0版本； redis集群采用P2P模式，是完全去中心化的，不存在中心节点或者代理节点； redis集群是没有统一的入口的，客户端（client）连接集群的时候连接集群中的任意节点（node）即可，集群内部的节点是相互通信的（PING-PONG机制），每个节点都是一个redis实例； 为了实现集群的高可用，即判断节点是否健康（能否正常使用），redis-cluster有这么一个投票容错机制：如果集群中超过半数的节点投票认为某个节点挂了，那么这个节点就挂了（fail）。这是判断节点是否挂了的方法； 那么如何判断集群是否挂了呢? -&amp;gt; 如果集群中任意一个节点挂了，而且该节点没有从节点（备份节点），那么这个集群就挂了。这是判断集群是否挂了的方法； 那么为什么任意一个节点挂了（没有从节点）这个集群就挂了呢？ -&amp;gt; 因为集群内置了16384个slot（哈希槽），并且把所有的物理节点映射到了这16384[0-16383]个slot上，或者说把这些slot均等的分配给了各个节点。当需要在Redis集群存放一个数据（key-value）时，redis会先对这个key进行crc16算法，然后得到一个结果。再把这个结果对16384进行求余，这个余数会对应[0-16383]其中一个槽，进而决定key-value存储到哪个节点中。所以一旦某个节点挂了，该节点对应的slot就无法使用，那么就会导致集群无法正常工作。 综上所述，每个Redis集群理论上最多可以有16384个节点。 Redis集群至少需要3个节点，因为投票容错机制要求超过半数节点认为某个节点挂了该节点才是挂了，所以2个节点无法构成集群。 要保证集群的高可用，需要每个节点都有从节点，也就是备份节点，所以Redis集群至少需要6台服务器。因为我没有那么多服务器，也启动不了那么多虚拟机，所在这里搭建的是伪分布式集群，即一台服务器虚拟运行6个redis实例，修改端口号为（7001-7006）1+1+1+1+1+1 = 6
搭建集群 Redis版本6.0.8 Gcc7x.x.x 创建目录 1mkdir /usr/local/redis-cluster 2cd /usr/local/redis-cluster 3wget http://download.redis.io/releases/redis-6.0.8.tar.gz 4mkdir {7001..7006} 复制配置文件 1tar -zxf redis-6.0.8.tar.gz 2cd redis-6.0.8/ &amp;amp;&amp;amp; make install 3cp -a redis-6.0.8/redis.conf 7001/ # 以此类推 4cp -a redis-6.0.8/redis.conf 7002/ 如果你不想编译安装的话,你可以把redis中的/bin目录的命令移动到每个node节点文件夹中，这样以方便你使用redis-server命令 编辑配置文件 此文件内容为集群模式最小配置文件内容.
1vim 7001/redis.conf # 以此类推,记得更改端口号和日志文件 2bind 127.0.0.1 # IP可更换为内网IP 3port 7001 4cluster-enabled yes 5cluster-config-file nodes7001.conf 6cluster-node-timeout 5000 7appendonly yes 8daemonize yes 9logfile /usr/local/redis-cluster/7001/redis-7001.</description></item></channel></rss>